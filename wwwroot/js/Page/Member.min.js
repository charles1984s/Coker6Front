function PageReady(){Coker.Member={GetOrderHistory:function(){return $.ajax({url:"/api/Order/GetHistoryOrder/",type:"GET",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})}};let e=$("#TWzipcode .address").val();co.Zipcode.init("#TWzipcode"),co.Zipcode.setData({el:$("#TWzipcode"),addr:e}),Coker.Token.CheckToken().done((function(e){e.isLogin?Member(e):co.sweet.warning("尚未登入","請登入後再重新操作，將引導至首頁。",(function(){location.href="/"}))}))}function Member(e){$("#ResetForm .reset_old_pass").removeClass("d-none"),$("#ResetForm .reset_old_pass input").removeAttr("disabled"),$("#ResetOldPassFeedBack").removeClass("d-none"),$("#ResetModal .btn_resetforget").removeClass("d-none"),SetMemberData(),SetHistoryOrderData(),SetFavoriteData(),SetBrowsingHistoryData(),$(".btn_logout").on("click",(function(){co.User.Logout().done((function(e){e.success&&(co.sweet.success("登出成功"),setTimeout((e=>{location.href="/"}),1e3))}))})),$(".btn_modifi").on("click",(function(){var e=co.Form.getJson($("#UserDataForm").attr("id"));""==e.name?co.sweet.error("輸入資料錯誤","姓名不可為空",null,!1):""==$("#Email").val()?co.sweet.error("輸入資料錯誤","電子郵件不可為空",null,!1):""==e.zone^""==e.telPhone?co.sweet.error("輸入資料錯誤","如要填入電話資訊，請確實填寫區碼與聯絡電話",null,!1):""==e.county^""==e.address?co.sweet.error("輸入資料錯誤","如要填入地址資訊，請確實填寫縣市、鄉鎮與地址",null,!1):(e.address=`${e.county} ${e.district} ${e.address}`,e.telPhone=`${e.zone}-${e.telPhone}-${e.ext}`,co.User.UserEdit(e).done((function(e){co.sweet.success("資料修改完成！",null,!0)})))})),$(".btn_resetPassword").on("click",(function(){resetModal.show()})),$(".btn_resetEmail").on("click",(function(){console.log("電子郵件修改按鈕按下")}))}function SetMemberData(){Coker.User.GetUser().done((function(e){if(e.success){null!=e.data.telPhone&&(e.data.zone=e.data.telPhone.split("-")[0],e.data.telPhone=e.data.telPhone.split("-")[1],2==e.data.telPhone.split("-").length&&(e.data.ext=e.data.telPhone.split("-")[2])),co.Form.insertData(e.data,"#UserDataForm"),co.Zipcode.setData({el:$("#TWzipcode"),addr:e.data.address}),$("#ResetForm").data("Email",e.data.email);var t=new Date,a=(t.getMonth()+1).toString();1==a.length&&(a="0"+a);var o=t.getDate().toString();1==o.length&&(o="0"+o);var n=`${t.getFullYear()}-${a}-${o}`;$("#Birthday").attr("max",n),$("#Birthday").on("keydown",(function(e){e.preventDefault()}))}}))}function SetHistoryOrderData(){Coker.Member.GetOrderHistory().done((function(e){e.success&&null!=e.orderData?$.each(e.orderData,(function(e,t){var a=t.orderHeader,o=t.orderDetails,n=$($("#Template_Order_List").html()).clone();switch(n.find(".number").text(("000000000"+a.id).substr(a.id.length)),n.find(".date").text(a.creationTime.substr(0,10).replaceAll("-","/")),n.find(".amount").text(a.total.toLocaleString()),a.state){case 1:n.find(".state").text("待確認");break;case 2:n.find(".state").text("已付款");break;case 3:n.find(".state").text("已出貨");break;case 4:n.find(".state").text("已取消");break;case 5:n.find(".state").text("付款失敗");break;case 6:n.find(".state").text("待付款");break;case 7:n.find(".state").text("已完成")}$("#profile-tab-pane").append(n),n.find(".collapse").addClass(`collapse_${a.id}`),n.find(".btn_collapse").attr("data-bs-target",`.collapse_${a.id}`),n.find(".btn_collapse").on("click",(function(){$(this).hasClass("collapsed")?$(this).text("點擊查看訂單詳細"):$(this).text("點擊關閉訂單詳細")})),$.each(o,(function(e,t){var a=$($("#Template_Order_Details_List").html()).clone();null!=t&&(a.find("a").attr("href",`/${OrgName}/Member/product/${t.pId}`),a.find("a").attr("title",`連結至：${t.title}`),a.find("img").attr("src",t.imagePath),a.find("img").attr("alt",`${t.title}的主要圖片`),a.find(".title").text(t.title),a.find(".price").text(t.price.toLocaleString()),a.find(".quantity").text(t.quantity),a.find(".subtotal").text((parseInt(t.price)*parseInt(t.quantity)).toLocaleString()),n.find(".list-group").append(a))})),n.find(".collapse .header_subtotal").text(a.subtotal.toLocaleString()),n.find(".collapse .header_freight").text(a.freight.toLocaleString()),n.find(".collapse .header_total").text(a.total.toLocaleString())})):$("#profile-tab-pane .nodata").removeClass("d-none")}))}function SetFavoriteData(){$("#favorite-tab-pane").children().not(".nodata").not("template").remove(),Coker.Favorites.GetDisplay().done((function(e){e.length>0?($.each(e,(function(e,t){var a=$($("#Template_Favorite_List").html()).clone();a.data("Pid",t.pId),a.find(".btn_favorite").data("Fid",t.fId),a.find("*").each((function(){var e=$(this);if(void 0!==e.data("key")){var a=e.data("key");switch(a){case"link":e.attr("href",`/${OrgName}/Member${t.link}`),e.attr("title",`連結至：${t.title}`);break;case"image":e.attr("src",t.image),e.attr("alt",`${t.title}的主要照片`);break;case"price":var o=t.price;o.length>1?e.text(`${o[0].toLocaleString()}~$${[o[o.length-1].toLocaleString()]}`):e.text(`${o[0].toLocaleString()}`);break;default:e.text(t[a])}}})),a.find(".shareBlock").hover((function(){$(this).addClass("show")}),(function(){$(this).removeClass("show")})),a.find(".btn_favorite").on("click",(function(){Coker.Favorites.Delete($(this).data("Fid")).done((function(e){e.success&&(SetBrowsingHistoryData(),Coker.sweet.success("已將商品從收藏中移除",null,!0),a.remove())}))})),$("#favorite-tab-pane").append(a),$("#favorite-tab-pane .nodata").hasClass("d-none")||$("#favorite-tab-pane .nodata").addClass("d-none")})),$(".shareBlock").cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]})):$("#favorite-tab-pane .nodata").removeClass("d-none")}))}function SetBrowsingHistoryData(){$("#history-tab-pane").children().not(".nodata").not("template").remove(),Product.GetAll.History().done((function(e){e.length>0?($.each(e,(function(e,t){var a=$($("#Template_Prod_List").html()).clone();a.data("Pid",t.id),a.find("*").each((function(){var e=$(this);if(void 0!==e.data("key")){var a=e.data("key");switch(a){case"link":e.attr("href",`/${OrgName}/Member${t.link}`),e.attr("title",`連結至：${t.title}`);break;case"image":e.attr("src",t.image),e.attr("alt",`${t.title}的主要照片`);break;case"price":var o=t.price;o.length>1?e.text(`${o[0].toLocaleString()}~$${[o[o.length-1].toLocaleString()]}`):e.text(`${o[0].toLocaleString()}`);break;default:e.text(t[a])}}})),a.find(".shareBlock").hover((function(){$(this).addClass("show")}),(function(){$(this).removeClass("show")}));var o=a.find(".btn_favorite");Coker.Favorites.Check(a.data("Pid")).done((function(e){e.success&&(o.data("Fid",e.message),o.find("i").addClass("fa-solid"),o.find("i").removeClass("fa-regular"),o.attr("title","移除收藏"))})),o.on("click",(function(){$self=$(this).find("i"),$self.hasClass("fa-regular")?Coker.Favorites.Add(a.data("Pid")).done((function(e){e.success?(o.data("Fid",e.message),$self.addClass("fa-solid"),$self.removeClass("fa-regular"),o.attr("title","移除收藏"),SetFavoriteData(),Coker.sweet.success("成功將商品加入收藏",null,!0)):console.log(e.message)})):void 0!==o.data("Fid")&&""!=typeof o.data("Fid")&&(Coker.Favorites.Delete(o.data("Fid")).done((function(e){e.success?(o.data("Fid",""),$self.addClass("fa-regular"),$self.removeClass("fa-solid"),o.attr("title","加入收藏"),SetFavoriteData(),Coker.sweet.success("已將商品從收藏中移除",null,!0)):console.log(e.message)})),console.log("非收藏商品"))})),$("#history-tab-pane").append(a)})),$(".shareBlock").cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]})):$("#history-tab-pane .nodata").removeClass("d-none")}))}