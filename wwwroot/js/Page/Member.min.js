var resetEmailModal,ResetEmailModal,$InputResetEmailVCode,$ResetEmailImgCaptcha,ResetEmailForms,reOrderAlertModal,ReOrderAlertModal,old_email,TabNow="info",date_now="";function PageReady(){Coker.Member={GetOrderHistory:function(e){return $.ajax({url:"/api/Order/GetHistoryOrder/",type:"GET",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")},data:{page:e}})},Reorder:function(e){return $.ajax({url:"/api/Order/Reorder/",type:"GET",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")},data:{ohid:e}})},CheckOrder:function(e){return $.ajax({url:"/api/Order/CheckOrder/",type:"GET",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")},data:{ohid:e}})},OrderRepay:function(e){return $.ajax({url:"/api/Order/OrderRepay",type:"POST",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")},data:JSON.stringify(e),dataType:"json"})},CancelOrder:function(e,t){return $.ajax({url:"/api/Order/CancelOrder/",type:"GET",contentType:"application/json; charset=utf-8",data:{ohid:e,payment:t}})}};let e=$("#TWzipcode .address").val();co.Zipcode.init("#TWzipcode"),co.Zipcode.setData({el:$("#TWzipcode"),addr:e}),Coker.Token.CheckToken().done((function(e){e.isLogin?Member(e):co.sweet.warning("尚未登入","請登入後再重新操作，將引導至首頁。",(function(){location.href="/"}))}))}function Member(e){var t=new Date,a=(t.getMonth()+1).toString();1==a.length&&(a="0"+a);var n=t.getDate().toString();1==n.length&&(n="0"+n),date_now=`${t.getFullYear()}-${a}-${n}`,resetEmailModal=$("#ResetEmailModal").length>0?new bootstrap.Modal($("#ResetEmailModal")):null,reOrderAlertModal=$("#ReOrderAlertModal").length>0?new bootstrap.Modal($("#ReOrderAlertModal")):null,$InputResetEmailVCode=$("#InputNewMailVCode"),$ResetEmailImgCaptcha=$("#NewMailImgCaptcha"),ResetEmailForms=$("#ResetEmailForm"),$("#ResetForm .reset_old_pass").removeClass("d-none"),$("#ResetForm .reset_old_pass input").removeAttr("disabled"),$("#ResetOldPassFeedBack").removeClass("d-none"),$("#ResetModal .btn_resetforget").removeClass("d-none"),SetMemberData(),WebPageChange(),$(".btn_logout").on("click",(function(){co.User.Logout().done((function(e){e.success&&(co.sweet.success("登出成功"),setTimeout((e=>{location.href="/"}),1e3))}))})),$(".btn_modifi").on("click",(function(){var e=co.Form.getJson($("#UserDataForm").attr("id"));if(""==e.name)co.sweet.warning("請注意","姓名不可為空",null);else if(""==$("#Email").val())co.sweet.warning("請注意","電子郵件不可為空",null);else if(""==e.zone^""==e.telPhone)co.sweet.warning("請注意","如要填入電話資訊，請確實填寫區碼與聯絡電話",null);else if(""==e.county^""==e.address)co.sweet.warning("請注意","如要填入地址資訊，請確實填寫縣市、鄉鎮與地址",null);else{var t=!0;""==e.birthday&&(e.birthday=null),e.address=`${e.county} ${e.district} ${e.address}`,""==e.cellPhone||$.isNumeric(e.cellPhone)&&10==e.cellPhone.length||(co.sweet.warning("請注意","手機格式不正確，請重新輸入",null),t=!1),""!=e.telPhone&&($.isNumeric(e.zone)&&$.isNumeric(e.telPhone)&&(""!=e.ext&&$.isNumeric(e.ext)||""==e.ext)?e.telPhone=`${e.zone}-${e.telPhone}-${e.ext}`:(co.sweet.warning("請注意","電話格式不正確，請重新輸入",null),t=!1)),t&&co.User.UserEdit(e).done((function(e){co.sweet.success("資料修改完成！",null,!0)}))}})),$(".btn_resetPassword").on("click",(function(){resetModal.show()})),$(".btn_resetEmail").on("click",(function(){resetEmailModal.show()})),$("#ResetEmailModal .btn_resetforget").on("click",(function(){$("#ResetModal .btn_resetforget").click()})),$("#ResetEmailModal .btn_refresh").on("click",(function(e){e.preventDefault(),NewCaptcha($ResetEmailImgCaptcha,$InputResetEmailVCode)})),null!=(ResetEmailModal=document.getElementById("ResetEmailModal"))&&(ResetEmailModal.addEventListener("show.bs.modal",(function(e){NewCaptcha($ResetEmailImgCaptcha,$InputResetEmailVCode)})),ResetEmailModal.addEventListener("hidden.bs.modal",(function(e){FormClear(ResetEmailForms,$InputResetEmailVCode)}))),null!=(ReOrderAlertModal=document.getElementById("ReOrderAlertModal"))&&ReOrderAlertModal.addEventListener("hidden.bs.modal",(function(e){$(".btn_repay").removeClass("d-none"),$("#ReOrderAlertModal .orderlist ul li").remove()})),$("#ResetEmailForm input").on("keypress",(function(e){13==e.which&&(e.preventDefault(),$("#ResetEmailModal .btn_resetmail").click())})),$(".btn_resetmail").on("click",(function(){SiteFormCheck(ResetEmailForms,$InputResetEmailVCode)?CaptchaVerify($ResetEmailImgCaptcha,$InputResetEmailVCode,(function(){ResetmailAction(e)})):($InputResetEmailVCode.addClass("is-invalid"),$InputResetEmailVCode.siblings("div").addClass("me-4 pe-2"),NewCaptcha($ResetEmailImgCaptcha,$InputResetEmailVCode),$InputResetEmailVCode.val(""),Coker.sweet.warning("請注意","請確實填寫資料",null,!0))})),$(".btn_switchViewType button").on("click",(function(){var e=$(this),t=e.siblings("button");e.hasClass("focus")||e.addClass("focus"),t.hasClass("focus")&&t.removeClass("focus");var a=e.parents(".tab-pane").find(".content");switch(e.data("type")){case"grid":localStorage.setItem(`switchViewType-Member${a.data("storagename")}`,"grid"),a.hasClass("type_grid")||a.addClass("type_grid"),a.hasClass("type_list")&&a.removeClass("type_list");break;case"list":localStorage.setItem(`switchViewType-Member${a.data("storagename")}`,"list"),a.hasClass("type_list")||a.addClass("type_list"),a.hasClass("type_grid")&&a.removeClass("type_grid")}})),void 0!==localStorage["switchViewType-MemberFavorite"]&&"list"==localStorage["switchViewType-MemberFavorite"]&&$("#favorite-tab-pane .btn_switchViewType button[data-type='list'").click(),void 0!==localStorage["switchViewType-MemberBrowsing"]&&"list"==localStorage["switchViewType-MemberBrowsing"]&&$("#history-tab-pane .btn_switchViewType button[data-type='list'").click(),$("#ToolList > li button").on("click",(function(){switch($(this).attr("id")){case"profile-tab":window.location.hash="#order";break;case"favorite-tab":window.location.hash="#favorites";break;case"history-tab":window.location.hash="#browsing";break;default:window.location.hash="#"}})),$("#ReOrderAlertModal .btn_cancelrepay").on("click",(function(){reOrderAlertModal.hide()})),"onhashchange"in window?window.onhashchange=hashChange:setInterval(hashChange,1e3)}function hashChange(e){e?(e.preventDefault(),WebPageChange()):console.log("HashChange錯誤")}function WebPageChange(){if(!window.location.hash.startsWith(`#${TabNow}`))if($("#TabContent > div").each((function(e){var t=$(this);t.hasClass("active")&&t.removeClass("active"),t.hasClass("show")&&t.removeClass("show")})),$("#ToolList > li button").each((function(e){var t=$(this);t.hasClass("active")&&t.removeClass("active")})),window.location.hash.startsWith("#order"))if($("#TabContent > div#profile-tab-pane").length>0)if($("#TabContent > div#profile-tab-pane").addClass("active show"),$("#ToolList > li button#profile-tab").addClass("active"),window.location.hash.indexOf("-")>0){var e=window.location.hash.substring(window.location.hash.indexOf("-")+1);isNaN(Number(e))?window.location.hash="#order-1":SetHistoryOrderPage(e)}else window.location.hash="#order-1";else window.location.hash="";else if(window.location.hash.startsWith("#browsing"))if($("#TabContent > div#history-tab-pane").addClass("active show"),$("#ToolList > li button#history-tab").addClass("active"),window.location.hash.indexOf("-")>0){e=window.location.hash.substring(window.location.hash.indexOf("-")+1);isNaN(Number(e))?window.location.hash="#browsing-1":SetBrowsingHistoryPage(e)}else window.location.hash="#browsing-1";else if(window.location.hash.startsWith("#favorites"))if($("#TabContent > div#favorite-tab-pane").addClass("active show"),$("#ToolList > li button#favorite-tab").addClass("active"),window.location.hash.indexOf("-")>0){e=window.location.hash.substring(window.location.hash.indexOf("-")+1);isNaN(Number(e))?window.location.hash="#favorites-1":SetFavoritesPage(e)}else window.location.hash="#favorites-1";else $("#TabContent > div#info-tab-pane").addClass("active show"),$("#ToolList > li button#info-tab").addClass("active")}function SetMemberData(){Coker.User.GetUser().done((function(e){e.success&&(null!=e.data.telPhone&&""!=e.data.telPhone&&(e.data.zone=e.data.telPhone.split("-")[0],e.data.telPhone=e.data.telPhone.split("-")[1],2==e.data.telPhone.split("-").length&&(e.data.ext=e.data.telPhone.split("-")[2])),co.Form.insertData(e.data,"#UserDataForm"),old_email=e.data.email,co.Zipcode.setData({el:$("#TWzipcode"),addr:e.data.address}),$("#ResetForm").data("Email",e.data.email),$("#Birthday").attr("max",date_now),$("#Birthday").on("keydown",(function(e){e.preventDefault()})))}))}function SetHistoryOrderPage(e){Coker.Member.GetOrderHistory(e).done((function(t){t.success&&null!=t.orderData&&t.orderData.length>0?(t.page_Total>1&&($("#profile-tab-pane .page_btn").data("init")||PageButtonInit($("#profile-tab-pane .page_btn"),t.page_Total,"order"),ContentPageChage($("#profile-tab-pane .page_btn"),e,t.page_Total)),$("#profile-tab-pane .btn_switchViewType").hasClass("d-none")&&$("#profile-tab-pane .btn_switchViewType").removeClass("d-none"),HistoryTemplateDataInsert(t.orderData)):1!=e?window.location.hash="#order-1":$("#profile-tab-pane .nodata").hasClass("d-none")&&$("#profile-tab-pane .nodata").removeClass("d-none")}))}function HistoryTemplateDataInsert(e){$("#profile-tab-pane .content").empty(),$.each(e,(function(e,t){var a=t.orderHeader,n=t.orderDetails,o=$($("#Template_Order_List").html()).clone();switch(o.find(".number").text(("000000000"+a.id).substring(a.id.length)),o.find(".date").text(a.creationTime.substr(0,16).replaceAll("-","/")),o.find(".amount").text(`$${a.total.toLocaleString()}`),void 0!==a.paymentIcon&&""!=a.paymentIcon?o.find(".payment").append(`<img src="${a.paymentIcon}"/><span>${a.payment}</span>`):o.find(".payment").text(a.payment),a.creationTime.split(" ")[0]==date_now&&[1,2,6].includes(a.state)?([7,8,10,15].includes(a.paymentCode)?o.find(".state").prepend(`<span>${a.stateStr}</span>`):o.find(".state").prepend(`<span>${a.stateStr}</span><button class="btn_cancelOrder bg-transparent border-0 text-decoration-underline" title="取消此筆訂單">取消訂單</button>`),o.find(".state button").data("ohid",a.id),o.find(".state .btn_cancelOrder").on("click",(function(){var e=$(this),t=[2,6].includes(a.state)?1!=a.thirdParties?"?(若已付款將退回款項)":"？(退款事宜請聯繫客服處理)":"?";Coker.sweet.confirm("取消訂單",`確定要取消這筆訂單${t}`,"確定","取消",(function(){Coker.sweet.loading(),Coker.Member.CancelOrder(e.data("ohid"),a.thirdParties).done((function(t){t.success?(e.parent(".state").addClass("text-danger fw-bold"),e.parent(".state").text("已取消"),Coker.sweet.success(t.message,null,!1)):Coker.sweet.error("取消訂單發生錯誤",t.message)}))}))}))):1!=a.thirdParties&&5==a.state?(o.find(".state").prepend(`<span>${a.stateStr}</span><button class="btn_payAgain text-danger bg-transparent border-0 text-decoration-underline text-danger" title="取消此筆訂單">重新付款</button>`),o.find(".state .btn_payAgain").on("click",(function(){$(this);Coker.sweet.confirm("確定要重新付款？","","確定","取消",(function(){Coker.sweet.loading(),Coker.Member.CheckOrder(a.id).done((function(e){if(e.success)if("NoChange"==e.message)OrderRepay(e);else{Swal.close(),reOrderAlertModal.show();var t=$("#ReOrderAlertModal .orderlist"),n=parseInt(e.orderHeader.oldSubtotal),o=parseInt(e.orderHeader.freight.replaceAll(",","")),s=parseInt(e.orderHeader.subtotal.replaceAll(",",""));t.find(".oh_subtotal_old").text(n.toLocaleString()),t.find(".oh_subtotal_new").text(s.toLocaleString()),t.find(".oh_freight").text(o.toLocaleString()),t.find(".oh_total").text((s+o).toLocaleString()),MemberTemplateDataInsert($("#ReOrderAlertModal .orderlist ul"),$("#RePayOrderListTemplate"),e.orderDetails),0==s?(o=0,$(".btn_repay").addClass("d-none")):($(".btn_repay").data("ohid",a.id),$(".btn_repay").data("thirdParties",a.thirdParties),$(".btn_repay").data("new_price",s+o)),$("#ReOrderAlertModal .btn_repay").off("click"),$("#ReOrderAlertModal .btn_repay").on("click",(function(){Coker.sweet.loading(),reOrderAlertModal.hide(),OrderRepay(e)}))}else Coker.sweet.error("重新付款發生錯誤",e.message)}))}))}))):o.find(".state").append(`<span>${a.stateStr}</span>`),a.state){case 1:case 6:o.find(".state span").addClass("bg-warning text-black");break;case 5:o.find(".state span").addClass("bg-danger text-white");break;default:4!=a.state&&o.find(".state span").addClass("bg-success text-white")}o.find(".collapse").addClass(`collapse_${a.id}`),o.find(".btn_collapse").attr("data-bs-target",`.collapse_${a.id}`),o.find(".btn_collapse").on("click",(function(){$(this).hasClass("collapsed")?$(this).text("查看訂單明細"):$(this).text("關閉訂單明細")})),o.find(".btn_buyAgain").data("ohid",a.id),o.find(".btn_buyAgain").on("click",(function(){var e=$(this);Coker.sweet.confirm("確定要再次購買？","","確定","取消",(function(){Coker.sweet.loading(),Coker.Member.Reorder(e.data("ohid")).done((function(e){if(e.success){var t=`000000000${e.message}`.substring(e.message.length);window.location.href=`/${OrgName}/ShoppingCar?reorder${t}`}else"該商品規格庫存量已在瀏覽期間被更動，按下確定後將重整頁面。"==e.message&&Coker.sweet.warning("商品庫存不足",e.message,null)}))}))})),$.each(n,(function(e,t){if(null!=t){var a=$($("#Template_Order_Details_List").html()).clone();a.find("a").attr("href",`/${OrgName}/Member/product/${t.pId}`),a.find("a").attr("title",`連結至：${t.title}`),t.imagePath=t.imagePath.replaceAll(`/${OrgName}/`,"/"),a.find("img").attr("src",t.imagePath),a.find("img").attr("alt",`${t.title}的主要圖片`),a.find(".title").text(t.title),""!=t.s1Title&&a.find(".spec").append(`<span class="border px-1 me-1">${t.s1Title}</span>`),""!=t.s2Title&&a.find(".spec").append(`<span class="border px-1 me-1">${t.s2Title}</span>`),a.find(".price").text(t.price.toLocaleString()),a.find(".quantity").text(t.quantity),a.find(".subtotal").text((parseInt(t.price)*parseInt(t.quantity)).toLocaleString()),o.find(".list-group").append(a)}})),o.find(".collapse .header_subtotal").text(a.subtotal.toLocaleString()),o.find(".collapse .header_freight").text(a.freight.toLocaleString()),o.find(".collapse .header_total").text(a.total.toLocaleString()),$("#profile-tab-pane .content").append(o)}))}function OrderRepay(e){var t={},a=[];$.each(e.orderDetails,(function(e,t){var n={};n.scid=t.scId,n.psid=t.prodStockId,n.Quantity=parseInt(t.quantity),n.Price=t.price,a.push(n)})),t.ohid=e.orderHeader.id,t.Subtotal=parseInt(e.orderHeader.subtotal.replaceAll(",","")),t.Details=a,Coker.Member.OrderRepay(t).done((function(t){t.success?Coker.ThirdParty.Request(e.orderHeader.id,e.orderHeader.thirdParties).done((function(e){e.success?(localStorage.setItem("lastSaveTime",(new Date).toISOString()),window.location.replace(e.message)):Coker.sweet.error("重新付款發生錯誤",e.message,null,!1)})):Coker.sweet.error("訂單更動發生錯誤",t.message)}))}function SetFavoritesPage(e){Coker.Favorites.GetDisplay(e).done((function(t){t.data.length>0?(t.page_Total>1?($(!0)&&$(".page_btn").removeClass("d-none"),$("#favorite-tab-pane .page_btn").data("init")||PageButtonInit($("#favorite-tab-pane .page_btn"),t.page_Total,"favorites"),ContentPageChage($("#favorite-tab-pane .page_btn"),e,t.page_Total)):$(!0)&&$(".page_btn").addClass("d-none"),$("#favorite-tab-pane .btn_switchViewType").hasClass("d-none")&&$("#favorite-tab-pane .btn_switchViewType").removeClass("d-none"),MemberTemplateDataInsert($("#favorite-tab-pane .content"),$("#FavoriteTemplate"),t.data)):1!=e?window.location.hash="#favorites-1":$("#favorite-tab-pane .nodata").hasClass("d-none")&&$("#favorite-tab-pane .nodata").removeClass("d-none")}))}function SetBrowsingHistoryPage(e){Product.GetAll.History(e).done((function(t){t.success&&t.data.length>0?(t.page_Total>1&&($("#history-tab-pane .page_btn").data("init")||PageButtonInit($("#history-tab-pane .page_btn"),t.page_Total,"browsing"),ContentPageChage($("#history-tab-pane .page_btn"),e,t.page_Total)),$("#history-tab-pane .btn_switchViewType").hasClass("d-none")&&$("#history-tab-pane .btn_switchViewType").removeClass("d-none"),MemberTemplateDataInsert($("#history-tab-pane .content"),$("#BrowsingTemplate"),t.data)):1!=e?window.location.hash="#browsing-1":$("#history-tab-pane .nodata").hasClass("d-none")&&$("#history-tab-pane .nodata").removeClass("d-none")}))}function PageButtonInit(e,t,a){e.removeClass("d-none");for(var n=1;n<=t;n++){var o="";n==t&&t>7&&(o+='<li class="page-item btn_page endhide">\n                                    <button class="d-none" title="..." disabled=\'disabled\'>...</button>\n                                </li>'),o+=`<li class="page-item btn_page">\n                                    <button class="d-none" data-page='${n}' title="切換至第${n}頁">${n}</button>\n                                </li>`,1==n&&t>7&&(o+='<li class="page-item btn_page starthide">\n                                    <button class="d-none" title="..." disabled=\'disabled\'>...</button>\n                                </li>'),e.find(".btn_next").before(o)}e.data("init",!0),e.find(".btn_prev button").on("click",(function(){$("html, body").animate({scrollTop:0},0);var e=$(this),n=window.location.hash.indexOf("-")<0?1:parseInt(window.location.hash.substring(window.location.hash.indexOf("-")+1));n>1&&(n-=1),ContentPageChage(e.parent("li").parent("ul"),n,t),window.location.hash=`#${a}-${n}`})),e.find(".btn_next button").on("click",(function(){$("html, body").animate({scrollTop:0},0);var e=$(this),n=window.location.hash.indexOf("-")<0?1:parseInt(window.location.hash.substring(window.location.hash.indexOf("-")+1));n<t&&(n+=1),ContentPageChage(e.parent("li").parent("ul"),n,t),window.location.hash=`#${a}-${n}`})),e.find(".btn_page button").on("click",(function(){$("html, body").animate({scrollTop:0},0);var e=$(this);ContentPageChage(e.parent("li").parent("ul"),e.data("page"),t),window.location.hash=`#${a}-${e.data("page")}`}))}function ContentPageChage(e,t,a){e.find("li").each((function(){var e=$(this).find("button");e.data("page")==t?(e.hasClass("focus")||e.addClass("focus"),void 0===e.attr("disabled")&&e.attr("disabled","disabled")):(e.hasClass("focus")&&e.removeClass("focus"),void 0!==e.attr("disabled")&&e.removeAttr("disabled"))})),a>7?(t<4?e.find("li.btn_page").each((function(){var e=$(this).find("button");e.data("page")<=5||e.data("page")==a?e.hasClass("d-none")&&e.removeClass("d-none"):e.hasClass("d-none")||e.addClass("d-none")})):t>a-3?e.find("li.btn_page").each((function(){var e=$(this).find("button");e.data("page")>=a-4||1==e.data("page")?e.hasClass("d-none")&&e.removeClass("d-none"):e.hasClass("d-none")||e.addClass("d-none")})):e.find("li.btn_page").each((function(){var e=$(this).find("button");parseInt(t)+2>=e.data("page")&&e.data("page")>=parseInt(t)-2||1==e.data("page")||e.data("page")==a?e.hasClass("d-none")&&e.removeClass("d-none"):e.hasClass("d-none")||e.addClass("d-none")})),e.find("li button[data-page=2]").hasClass("d-none")&&e.find("li.starthide button").hasClass("d-none")&&e.find("li.starthide button").removeClass("d-none"),e.find(`li button[data-page=${a-1}]`).hasClass("d-none")&&e.find("li.endhide button").hasClass("d-none")&&e.find("li.endhide button").removeClass("d-none")):e.find("li").each((function(){var e=$(this).find("button");e.hasClass("d-none")&&e.removeClass("d-none")}))}function MemberTemplateDataInsert(e,t,a){e.empty(),$.each(a,(function(a,n){var o=$(t.html()).clone();(o=MemberDataInsert(o,n)).find(".btn_favorite").length>0&&FavoritesButtonInit(o),o.find(".shareBlock").length>0&&ShareButtonInit(o.find(".shareBlock")),e.append(o)}))}function MemberDataInsert(e,t){return e.data("Pid",t.pId),e.find(".btn_favorite").length>0&&null!=typeof t.fId&&e.find(".btn_favorite").data("Fid",t.fId),e.find("*").each((function(){var e=$(this);if(void 0!==e.data("key")){var a=e.data("key");switch(a){case"link":e.attr("href",`/${OrgName}/Member${t[a]}`),e.attr("title",`連結至：${t.title}`);break;case"image":case"imagePath":t[a]=t[a].replaceAll(`/${OrgName}/`,"/"),e.attr("src",t[a]),e.attr("alt",`${t.title}的主要照片`);break;case"price":if("object"==typeof t[a]){var n=t[a];null==n?e.text(""):n.length>1&&n[0]!=n[n.length-1]?e.html(`$${n[0].toLocaleString()}<wbr>~<wbr>$${[n[n.length-1].toLocaleString()]}`):e.text(`$${n[0].toLocaleString()}`)}else e.text(t[a].toLocaleString());break;case"describe":"商品已下架"==t[a]&&(e.removeClass("d-none"),e.siblings().addClass("d-none")),e.text(t[a]);break;case"s1Title":case"s2Title":""!=t[a]&&e.removeClass("d-none"),e.text(t[a]);break;case"oldPrice":0!=t[a]&&t[a]!=t.price&&(e.removeClass("d-none"),e.text(t[a].toLocaleString()),e.siblings().addClass("red_text"));break;case"oldQuantity":0!=t[a]&&t[a]!=t.quantity&&(e.removeClass("d-none"),e.text(t[a]),e.siblings().addClass("red_text"));break;case"subtotal_old":var o=0!=t.oldPrice?t.oldPrice:t.price,s=0!=t.oldQuantity?t.oldQuantity:t.quantity;e.text((o*s).toLocaleString());break;case"subtotal_new":var i=t.price*t.quantity;e.text(i.toLocaleString());break;default:e.text(t[a])}}})),e}function ShareButtonInit(e){e.hover((function(){$(this).addClass("show")}),(function(){$(this).removeClass("show")})),e.cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]})}function FavoritesButtonInit(e){var t=e.find(".btn_favorite");void 0===t.data("Fid")&&Coker.Favorites.Check(e.data("Pid")).done((function(e){e.success&&(t.data("Fid",e.message),t.find("i").addClass("fa-solid"),t.find("i").removeClass("fa-regular"),t.attr("title","移除收藏"))})),t.on("click",(function(){$self=$(this).find("i"),$self.hasClass("fa-regular")?Coker.Favorites.Add(e.data("Pid")).done((function(e){e.success?(t.data("Fid",e.message),$self.addClass("fa-solid"),$self.removeClass("fa-regular"),t.attr("title","移除收藏"),Coker.sweet.success("成功將商品加入收藏",null,!0)):console.log(e.message)})):void 0!==t.data("Fid")&&""!=typeof t.data("Fid")&&Coker.Favorites.Delete(t.data("Fid")).done((function(e){e.success?(t.data("Fid",""),$self.addClass("fa-regular"),$self.removeClass("fa-solid"),t.attr("title","加入收藏"),Coker.sweet.success("已將商品從收藏中移除",(function(){var e=window.location.hash.substring(window.location.hash.indexOf("-")+1);isNaN(Number(e))||SetFavoritesPage(e)}),!1)):console.log(e.message)}))}))}function ResetmailAction(e){var t=co.Form.getJson($("#ResetEmailForm").attr("id"));t.email==old_email?(Coker.sweet.info("新的電子郵件與舊的相同，不進行變更。",null),resetEmailModal.hide()):(Coker.sweet.loading(),Coker.User.EmailChange(t).done((function(e){if(e.success)Coker.sweet.success("電子郵件修改成功",(function(){location.reload()}),!1);else if(NewCaptcha($ResetEmailImgCaptcha,$InputResetEmailVCode),"密碼錯誤"===e.error)Coker.sweet.confirm("密碼輸入錯誤",e.message,"忘記密碼?","確定",(function(){$("#ResetModal .btn_resetforget").click()}));else Coker.sweet.error(e.error,e.message,null,!1)})))}