function PageReady(){Coker.Member={GetOrderHistory:function(){return $.ajax({url:"/api/Order/GetHistoryOrder/",type:"GET",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})}};let e=$("#TWzipcode .address").val();co.Zipcode.init("#TWzipcode"),co.Zipcode.setData({el:$("#TWzipcode"),addr:e}),Coker.Token.CheckToken().done((function(e){e.isLogin?Member(e):co.sweet.warning("尚未登入","請登入後再重新操作，將引導至首頁。",(function(){location.href="/"}))}))}function Member(e){$("#ResetForm .reset_old_pass").removeClass("d-none"),$("#ResetForm .reset_old_pass input").removeAttr("disabled"),$("#ResetOldPassFeedBack").removeClass("d-none"),$("#ResetModal .btn_resetforget").removeClass("d-none"),SetMemberData(),SetHistoryOrderData(),SetBrowsingHistoryData(),$(".btn_logout").on("click",(function(){co.User.Logout().done((function(e){e.success&&(co.sweet.success("登出成功"),setTimeout((e=>{location.href="/"}),1e3))}))})),$(".btn_modifi").on("click",(function(){if(""==$("#Name").val())co.sweet.error("輸入資料錯誤","姓名不可為空",null,!1);else if(""==$("#Email").val())co.sweet.error("輸入資料錯誤","電子郵件不可為空",null,!1);else{var e=co.Form.getJson($("#UserDataForm").attr("id"));e.address=`${e.county} ${e.district} ${e.address}`,co.User.UserEdit(e).done((function(e){co.sweet.success("資料修改完成！",null,!0)}))}})),$(".btn_resetPassword").on("click",(function(){resetModal.show()}))}function SetMemberData(){Coker.User.GetUser().done((function(e){if(e.success){co.Form.insertData(e.data,"#UserDataForm"),$("#ResetForm").data("Email",e.data.email),co.Zipcode.setData({el:$("#TWzipcode"),addr:e.data.address});var t=new Date,r=(t.getMonth()+1).toString();1==r.length&&(r="0"+r);var o=t.getDate().toString();1==o.length&&(o="0"+o);var a=`${t.getFullYear()}-${r}-${o}`;$("#Birthday").attr("max",a),$("#Birthday").on("keydown",(function(e){e.preventDefault()}))}}))}function SetHistoryOrderData(){Coker.Member.GetOrderHistory().done((function(e){e.success&&null!=e.orderData?$.each(e.orderData,(function(e,t){var r=$($("#Template_Order_List").html()).clone();r.find(".number").text(("000000000"+t.orderHeader.id).substr(t.orderHeader.id.length)),r.find(".date").text(t.orderHeader.creationTime.substr(0,10).replaceAll("-","/")),r.find(".amount").text(t.orderHeader.total.toLocaleString()),$("#profile-tab-pane").append(r)})):$("#profile-tab-pane .nodata").removeClass("d-none")}))}function SetBrowsingHistoryData(){Product.GetAll.History().done((function(e){e.length>0?($.each(e,(function(e,t){var r=$($("#Template_Prod_List").html()).clone();r.find("*").each((function(){var e=$(this);if(void 0!==e.data("key")){var r=e.data("key");switch(r){case"link":e.attr("href",`/${OrgName}/Member${t.link}`),e.attr("title",`連結至：${t.title}`);break;case"image":e.attr("src",t.image),e.attr("alt",`${t.title}的主要照片`);break;default:e.text(t[r])}}})),r.find(".shareBlock").hover((function(){$(this).addClass("show")}),(function(){$(this).removeClass("show")})),$("#history-tab-pane").append(r)})),$(".shareBlock").cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]})):$("#history-tab-pane .nodata").removeClass("d-none")}))}