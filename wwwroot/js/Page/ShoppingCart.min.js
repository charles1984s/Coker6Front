var buy_step_swiper,$Orderer_TWzipcode,$Recipient_TWzipcode,$Bill_TWzipcode,ShippingForms,PaymentForms,OrdererForms,RecipientForms,BillForms,gotop_switch=!1,OrdererOpen=!1,RecipientOpen=!1,BillOpen=!1,shipMethodsChosen=!1,payMethodsChosen=!1,OrdererFilled=!0,RecipientFilled=!0,BillFilled=!0,isCheckout=!1;function PageReady(){(buy_step_swiper=new Swiper("#BuyStepSwiper > .swiper",{slidesPerView:1,spaceBetween:15,autoHeight:!0,loop:!1,pagination:{el:".swiper_pagination > .swiper_pagination_buystep",clickable:!0,renderBullet:function(e,t){return'<span class="'+t+'">'+(e+1)+"</span>"}},navigation:{nextEl:".btn_swiper_next_buystep",prevEl:".btn_swiper_prev_buystep"}})).on("slideChangeTransitionEnd",(function(){gotop_switch&&window.scrollTo(0,$(".swiper").offset().top-$("header").height())})),buy_step_swiper.on("slideChange",(function(){switch(buy_step_swiper.activeIndex){case 2:shipMethodsChosen=FormCheck(ShippingForms),payMethodsChosen=FormCheck(PaymentForms),shipMethodsChosen&&payMethodsChosen||(Coker.sweet.error("請確實選擇運送及付款方式！",null,!0),setTimeout((function(){buy_step_swiper.slideTo(1)}),1500));break;case 3:isCheckout?$("#Pruchase_Content > .status_alert").text("訂單已成立，謝謝您的訂購！"):(OrdererOpen&&(OrdererFilled=FormCheck(OrdererForms)),RecipientOpen&&(RecipientFilled=FormCheck(RecipientForms)),BillOpen&&(BillFilled=FormCheck(BillForms)),Coker.sweet.error("未完成結帳流程！","若資料已確實填寫完畢，請點選下方[確認付款]按鈕進入付款程序",null,!1),setTimeout((function(){buy_step_swiper.slideTo(2)}),1500))}})),$Orderer_TWzipcode=$("#Orderer_TWzipcode"),$Recipient_TWzipcode=$("#Recipient_TWzipcode"),$Bill_TWzipcode=$("#Bill_TWzipcode"),TWZipCodeInit(),top_position=$(".swiper").offset().top,$(window).scroll((function(){var e=$(".swiper").offset().top-$("header").height();gotop_switch=document.body.scrollTop>e||document.documentElement.scrollTop>e})),$.cookie("subtotal","",{path:"/"}),$.cookie("shipping_fee","",{path:"/"}),$.cookie("total_amount","",{path:"/"}),$.cookie("payment_method","",{path:"/"}),HasProduct()&&ReloadAllAmount();Array.prototype.slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map((function(e){return new bootstrap.Popover(e)}));document.addEventListener("keyup",AutoSwapInput),$("input, label").mousedown((function(e){buy_step_swiper.allowTouchMove=!1})),$("input, label").mouseup((function(e){buy_step_swiper.allowTouchMove=!0})),ShippingForms=$("#ShippingRadio"),PaymentForms=$("#PaymentRadio"),$(".btn_step2_next").on("click",Step2Monitor),OrdererForms=$("#OrdererForm > form"),RecipientForms=$("#RecipientForm > form"),BillForms=$("#BillForm > form"),$(".btn_checkout").on("click",Step3Monitor),$(".btn_back_to_check").on("click",(function(){buy_step_swiper.slideTo(0)})),$(".btn_goprev").on("click",(function(){buy_step_swiper.slidePrev()})),$(".btn_move_to_favorites").on("click",MoveToFavorites),$(".btn_remove_pro").on("click",RemoveProduct),$(".btn_count_plus").on("click",AmountPlus),$(".btn_count_minus").on("click",AmountMinus),$(".btn_edit_data").on("click",OrdererEdit),$(".btn_delete_recipient").on("click",DeleteRecipient),$("input[type=radio][name=ShippingRadio]").change(ShippingRadio),$("input[type=radio][name=PaymentRadio]").change(PaymentRadio),$("input[type=radio][name=RecipientRadio]").change(RecipientRadio),$("input[type=radio][name=BillRadio]").change(BillRadio)}function TWZipCodeInit(){var e,t,i,n;$Orderer_TWzipcode.twzipcode({zipcodeIntoDistrict:!0,countySel:"高雄市",districtSel:"前鎮區"}),$Recipient_TWzipcode.twzipcode({zipcodeIntoDistrict:!0}),$Bill_TWzipcode.twzipcode({zipcodeIntoDistrict:!0}),e=$Orderer_TWzipcode.children(".county"),t=$Orderer_TWzipcode.children(".district"),e.children("select").attr({id:"OrdererSelectCity",class:"orderer_city form-select",required:"required"}),e.append("<label class='px-4 required' for='OrdererSelectCity'>縣市</label>"),(i=e.children("select").children("option").first()).text("請選擇縣市"),i.attr("disabled","disabled"),t.children("select").attr({id:"OrdererSelectTown",class:"orderer_town form-select",required:"required"}),t.append("<label class='px-4 required' for='OrdererSelectCity'>鄉鎮</label>"),(n=t.children("select").children("option").first()).text("請選擇鄉鎮"),n.attr("disabled","disabled"),e=$Recipient_TWzipcode.children(".county"),t=$Recipient_TWzipcode.children(".district"),e.children("select").attr({id:"RecipientSelectCity",class:"recipient_city form-select",required:"required"}),e.append("<label class='px-4 required' for='RecipientSelectCity'>縣市</label>"),(i=e.children("select").children("option").first()).text("請選擇縣市"),i.attr("disabled","disabled"),t.children("select").attr({id:"RecipientSelectTown",class:"recipient_town form-select",required:"required"}),t.append("<label class='px-4 required' for='RecipientSelectCity'>鄉鎮</label>"),(n=t.children("select").children("option").first()).text("請選擇鄉鎮"),n.attr("disabled","disabled"),e=$Bill_TWzipcode.children(".county"),t=$Bill_TWzipcode.children(".district"),e.children("select").attr({id:"BillSelectCity",class:"bill_city form-select",required:"required"}),e.append("<label class='px-4 required' for='BillSelectCity'>縣市</label>"),(i=e.children("select").children("option").first()).text("請選擇縣市"),i.attr("disabled","disabled"),t.children("select").attr({id:"BillSelectTown",class:"bill_town form-select",required:"required"}),t.append("<label class='px-4 required' for='BillSelectCity'>鄉鎮</label>"),(n=t.children("select").children("option").first()).text("請選擇鄉鎮"),n.attr("disabled","disabled")}function Step2Monitor(){shipMethodsChosen=FormCheck(ShippingForms),payMethodsChosen=FormCheck(PaymentForms),shipMethodsChosen&&payMethodsChosen?buy_step_swiper.slideNext():Coker.sweet.error("請確實選擇運送及付款方式！",null,!0),buy_step_swiper.update()}function ShippingRadio(){$.cookie("shipping_fee",this.value,{path:"/"}),AllAmountChange()}function PaymentRadio(){$.cookie("payment_method",this.value,{path:"/"});var e=$(".payment_method");e.text($.cookie("payment_method")),e.addClass("fs-2 fw-bold px-3"),"ATM"==$.cookie("payment_method")?$(".pay_byATM").removeClass("d-none"):$(".pay_byATM").addClass("d-none"),buy_step_swiper.update()}function Step3Monitor(){OrdererOpen&&(OrdererFilled=FormCheck(OrdererForms)),RecipientOpen&&(RecipientFilled=FormCheck(RecipientForms)),BillOpen&&(BillFilled=FormCheck(BillForms)),OrdererFilled&&RecipientFilled&&BillFilled?Coker.sweet.confirm("是否確定結帳？","點選確認進入付款流程","是，開始付款","否",(function(){Coker.sweet.success("謝謝您的訂購！<br />訂單處理中，若有錯誤請修正後重送訂單。請勿按[回上頁]按鈕，以免重複下單，或發生其他不可預期的錯誤！",(function(){setTimeout((function(){isCheckout=!0,setTimeout((function(){$.cookie("Purchased_Type_Quantity",0,{path:"/"}),$.cookie("Purchased_Item_Quantity",0,{path:"/"}),CarDropdownReset(),buy_step_swiper.slideNext(),buy_step_swiper.disable()}),300)}),300)}))})):Coker.sweet.error("請確實填寫資料！",null,!0),buy_step_swiper.update()}function OrdererEdit(){$("#OrdererForm > .default_data").toggleClass("d-none"),$("#OrdererForm > form").toggleClass("d-none"),OrdererFilled=!(OrdererOpen=!OrdererOpen),buy_step_swiper.update()}function RecipientRadio(){"edit"==this.value?($("#RecipientForm > .default_data").addClass("d-none"),$("#RecipientForm > form").removeClass("d-none"),RecipientOpen=!0):($("#RecipientForm > .default_data").removeClass("d-none"),$("#RecipientForm > form").addClass("d-none"),RecipientOpen=!1,RecipientFilled=!0),buy_step_swiper.update()}function BillRadio(){"company"==this.value?($("#BillForm > .default_data").addClass("d-none"),$("#BillForm > form").removeClass("d-none"),BillOpen=!0):($("#BillForm > .default_data").removeClass("d-none"),$("#BillForm > form").addClass("d-none"),BillOpen=!1,BillFilled=!0),buy_step_swiper.update()}function FormCheck(e){var t=!1;return Array.from(e).forEach((e=>{e.checkValidity()&&(t=!0),e.classList.add("was-validated")})),t}function AmountPlus(){var e=$(this).parents(".content").first().children(".pro_unit"),t=$(this).parents(".content").first().children(".pro_subtotal"),i=$(this).parents(".counter_input").first().children("input");i.val(parseInt(i.val())+1),$.cookie("Purchased_Item_Quantity",parseInt($.cookie("Purchased_Item_Quantity"))+1,{path:"/"});var n=parseInt(e.data("unitprice"))*parseInt(i.val());t.text(n.toLocaleString("en-US")),$.cookie("subtotal",parseInt($.cookie("subtotal"))+e.data("unitprice"),{path:"/"}),AllAmountChange(),CarItemChange()}function AmountMinus(){var e=$(this).parents(".content").first().children(".pro_unit"),t=$(this).parents(".content").first().children(".pro_subtotal"),i=$(this).parents(".counter_input").first().children("input");if(parseInt($.cookie("Purchased_Item_Quantity"))>1){$.cookie("Purchased_Item_Quantity",parseInt($.cookie("Purchased_Item_Quantity"))-1,{path:"/"}),i.val(parseInt(i.val())-1);var n=parseInt(e.data("unitprice"))*parseInt(i.val());t.text(n.toLocaleString("en-US")),$.cookie("subtotal",parseInt($.cookie("subtotal"))-e.data("unitprice"),{path:"/"}),AllAmountChange(),CarItemChange()}}function AmountEnter(){var e=$("#Step1 > .card-body > .purchase_list > .purchase_item > .content"),t=e.children(".pro_unit"),i=e.children(".pro_subtotal"),n=e.children(".counter_input").children(".pro_quantity");n.val()<=0?(n.val(1),$.cookie("Purchased_Item_Quantity",1,{path:"/"})):$.cookie("Purchased_Item_Quantity",n.val(),{path:"/"});var r=parseInt(t.data("unitprice"))*parseInt(n.val());i.text(r.toLocaleString("en-US"));var o=0;$(".purchase_item").each((function(){var e=$(this).children(".content").children(".pro_unit"),t=$(this).children(".content").children(".counter_input").children(".pro_quantity");o+=e.data("unitprice")*t.val()})),$.cookie("subtotal",o,{path:"/"}),AllAmountChange(),CarItemChange()}function MoveToFavorites(){$selfparent=$(this).parents("li").first(),Coker.sweet.confirm("確定將商品加入收藏？","該商品將會加入收藏並從購物車中移除","加入收藏","取消",(function(){$selfparent.remove(),Coker.sweet.success("成功加入收藏！",null,!0),$.cookie("Purchased_Type_Quantity",0,{path:"/"}),$.cookie("Purchased_Item_Quantity",0,{path:"/"}),HasProduct()&&ReloadAllAmount(),buy_step_swiper.update(),CarDropdownReset()}))}function RemoveProduct(){$selfparent=$(this).parents("li").first(),Coker.sweet.confirm("確定將商品從購物車移除？","該商品將會從購物車中移除，且不可復原。","確認移除","取消",(function(){$selfparent.remove(),Coker.sweet.success("成功移除商品",null,!0),$.cookie("Purchased_Type_Quantity",0,{path:"/"}),$.cookie("Purchased_Item_Quantity",0,{path:"/"}),HasProduct()&&ReloadAllAmount(),buy_step_swiper.update(),CarDropdownReset()}))}function HasProduct(){return $.cookie("Purchased_Type_Quantity")>0?($("#Purchase_Null").addClass("d-none"),$("#Step1 > .card-body").removeClass("d-none"),buy_step_swiper.enable(),PurchaseListInit(),!0):($("#Purchase_Null").removeClass("d-none"),$("#Step1 > .card-body").addClass("d-none"),buy_step_swiper.disable(),!1)}function PurchaseListInit(){var e=$($("#Template_Purchase_Details").html()).clone(),t=e.find(".pro_link"),i=e.find(".pro_image"),n=e.find(".pro_name"),r=e.find(".pro_specification"),o=e.find(".pro_instructions"),a=e.find(".pro_unit"),l=e.find(".pro_quantity");t.attr("href","/Toilet/01"),i.attr("src","../images/product/pro_pic_01.jpg"),n.text("CS230 一段省水分離式幼兒馬桶"),r.text("白色"),o.text("規格說明文字"),a.data("unitprice",9100),l.val($.cookie("Purchased_Item_Quantity")),$("#Step1 > .card-body > .purchase_list").append(e)}function ReloadAllAmount(){var e=0;$(".purchase_item").each((function(){var t=$(this).children(".content").children(".pro_unit"),i=$(this).children(".content").children(".counter_input").children(".pro_quantity"),n=$(this).children(".content").children(".pro_subtotal");t.text(t.data("unitprice").toLocaleString("en-US")),e+=t.data("unitprice"),n.text((parseInt(t.data("unitprice"))*i.val()).toLocaleString("en-US"))})),$.cookie("subtotal",e,{path:"/"}),AllAmountChange()}function AllAmountChange(){$(".priceline > div > .subtotal").each((function(){$(this).text(parseInt($.cookie("subtotal")).toLocaleString("en-US"))})),$(".priceline > div > .shipping_fee").each((function(){$(this).text(parseInt($.cookie("shipping_fee")).toLocaleString("en-US"))})),$.cookie("total_amount",parseInt($.cookie("subtotal"))+parseInt($.cookie("shipping_fee")),{path:"/"}),$(".total_amount").each((function(){$(this).text(parseInt($.cookie("total_amount")).toLocaleString("en-US"))}))}function AutoSwapInput(){var e=event.target;if("INPUT"==e.nodeName)if(e.className.indexOf("pro_quantity")>=0)AmountEnter();else if(e.value.length==e.maxLength){var t=$(e).parents("form").first().find("input");for(let i=0;i<t.length;i++)if(t[i]==e)return void(t[i+1]&&t[i+1].focus())}}function DeleteRecipient(){$(this).parents("tr").remove()}