var $input_quantity,Pid,s1,s2,spectype_list,spec_list,img_origin_list,preview_swiper,product_swiper,$pro_itemNo,$counter_input,CanShop,s1_list=[],s2_list=[],price_list=[];const showRange=!1;function PageReady(){if(ElementInit(),CanShop=$(".btn_addToCar").length>0,window.CI360.init(),Pid=null==ProdId||isNaN(ProdId)?location.pathname.substring(location.pathname.lastIndexOf("/")+1):ProdId,isNaN(Pid)&&/\/[\d]+\//.test(location.pathname)){const t=location.pathname.match(/\/[\d]+\//g);t.length>0&&(Pid=t[t.length-1].replace(/\//g,""))}Product.Log.Click(Pid).done((function(){})),Product.GetOne.ProdMainDisplay(Pid).done((function(t){null!=t?PageDefaultSet(t):window.location.href=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))})),$(".pro_display").on("click",ShowBigPro);document.getElementById("ProDisplayModal").addEventListener("hidden.bs.modal",(t=>{window.CI360.destroy(),$("#Pro_Youtube").attr("src","")})),$(".btn_addToCar").on("click",(function(){$(".btn_addToCar").hasClass("close")||AddToCart()})),$("#shareBlock").cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]}),$(document).on("click",".btn_count_plus",(function(){$input_quantity.val(parseInt($input_quantity.val())+parseInt($input_quantity.attr("step"))),$input_quantity.trigger("change")})),$(document).on("click",".btn_count_minus",(function(){$input_quantity.val(parseInt($input_quantity.val())-parseInt($input_quantity.attr("step"))),0==$input_quantity.val()&&$input_quantity.val(parseInt($input_quantity.attr("step"))),$input_quantity.trigger("change")})),$input_quantity.on("change",(function(){let t=$(this).val()-$(this).val()%$(this).attr("step");t>parseInt($(this).attr("max"))&&(t=parseInt($(this).attr("max"))),t<parseInt($(this).attr("min"))&&(t=parseInt($(this).attr("min"))),$(this).val(t)}));var t=$("#Product > .content > .options > .radio > .control");t.children().length<=2&&t.children("label").toggleClass("pe-none"),$(".btn_tc").on("click",(function(){$("#ProductDescription").removeClass("active show"),$("#TechnicalDocuments").addClass("active show"),$("#pills-description-tab").removeClass("active"),$("#pills-documents-tab").addClass("active");var t=$(this).data("tcid");$(".badge_directions").each((function(){var e=$(this);e.data("pro_tc")==t&&$("html, body").animate({scrollTop:e.offset().top-2*$("header").height()},0)}))})),$(".btn_favorites").length>0&&(Coker.Favorites.Check(Pid).done((function(t){t.success&&($(".btn_favorites").data("Fid",t.message),$(".btn_favorites").addClass("turn"),$(".btn_favorites").attr("title","移除收藏"))})),$(".btn_favorites").on("click",(function(){var t=$(this);t.hasClass("turn")?Coker.Favorites.Delete($(this).data("Fid")).done((function(e){e.success&&(t.removeClass("turn"),t.attr("title","加入收藏"),Coker.sweet.success("已將商品從收藏中移除",null,!0))})):Coker.Favorites.Add(Pid).done((function(e){e.success&&(t.addClass("turn"),t.data("Fid",e.message),t.attr("title","移除收藏"),Coker.sweet.success("成功將商品加入收藏",null,!0))}))})))}function ElementInit(){$input_quantity=$(".input_pro_quantity"),$counter_input=$(".counter_input"),$prod_content=$("#Product > .content"),$pro_name=$prod_content.find(".pro_title"),$pro_itemNo=$prod_content.find(".pro_itemNo"),$pro_introduce=$prod_content.find(".introduce"),$pro_specification=$prod_content.find(".specification").children("ul"),$pro_price=$prod_content.find(".ori_price"),$pro_discount=$prod_content.find(".discount"),$btn_detailed=$prod_content.find(".btn_detailed"),$options=$prod_content.find(".options")}function PageDefaultSet(t){1==t.stocks.length&&t.stocks[0].stock<=0&&($(".btn_addToCar").addClass("close"),$("#Product .content .options").addClass("d-none")),$pro_name.text(t.title),$pro_itemNo.text(t.itemNo),$pro_introduce.append("<li>"+t.introduction.replaceAll("\n","</li><li>")+"</li>"),$pro_specification.append("<li>"+t.description.replaceAll("\n","</li><li>")+"</li>");var e=0;if($pro_specification.children("li").each((function(){e+=$(this).height()})),e>$pro_specification.height()&&$btn_detailed.removeClass("d-none"),null!=t.html&&""!=t.html.trim()?$("#ProductDescription > Content").removeClass("d-none").html($.htmlDecode(t.html)):$("#ProductDescription,#btn_tab .description").remove(),t.techCertDatas.forEach((t=>{t.img_small.length>0?(t.img_small.forEach((function(e){$(".pro_tc > ul").append(`<li class="me-1"><button class="btn_tc bg-transparent border-0" data-tcid="${t.id}"><img src="${e.link}" alt="${e.name}" /></button></li>`),$(".pro_tc > ul img").imgCheck()})),t.img_orig.forEach((function(e){$(".pro_tc_content > .techcert_list").append(`<div class="badge_${t.id} row pb-3">\n\t\t\t                                                      <div class="col-12 col-lg-2 col-md-5 text-center verticalAlign">\n\t\t\t\t                                                      <img class="" src="${e.link}" alt="${e.name}" />\n\t\t\t                                                      </div>\n\t\t\t                                                      <div class="description align-self-center col">${t.description}</div>\n\t\t                                                      </div>\n\t\t                                                      <hr class="m-1" />`),$(".pro_tc_content > .techcert_list img").imgCheck()}))):$(".pro_tc").addClass("d-none")})),0!=t.status&&$("#Product>.image").append(`<span class="status status${t.status}">${t.statusName}</span>`),$(".pro_tc").hasClass("d-none")||$(".btn_tc").on("click",(function(){$("#TabContent .tab-pane").removeClass("active show"),$("#TechnicalDocuments").addClass("active show"),$("#btn_tab .nav-link").removeClass("active"),$("#pills-documents-tab").addClass("active");var t=$(this);$("html, body").animate({scrollTop:$(`.badge_${t.data("tcid")}`).offset().top-2*$("header > nav").height()},0)})),0==t.techCertDatas.length&&$("#btn_tab > .technical,.pro_tc").remove(),t.stocks.length>1){var i={},a=$($("#Template_Spec_Radio").html()).clone(),n=$($("#Template_Spec_Radio").html()).clone(),s=a.find(".spec_control"),o=n.find(".spec_control");a.data("stype",1),n.data("stype",2);var d=0,l=0,r=!1;t.stocks.forEach((t=>{i={s1id:t.fK_S1id,s2id:t.fK_S2id,stock:t.stock,minQty:t.min_Qty,price:t.prices[0].price},price_list.push(i),d=i.price>d?i.price:d,l=i.price<l||0==l?i.price:l,i={};var e="";console.log(t),t.stock<=0&&CanShop?e='disabled="disabled"':r=!0,t.fK_S1id>0?s1_list.indexOf(t.fK_S1id)<0&&(s.append(`<input id="s1_${t.fK_S1id}" type="radio" class="btn-check" name="S1_Radio" autocomplete="off" value="${t.fK_S1id}" ${e}>`),s.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s1_'+t.fK_S1id+'">'+t.s1_Title+"</label>"),s1_list.push(t.fK_S1id)):!s1>=0&&(s1=0),t.fK_S2id>0?s2_list.indexOf(t.fK_S2id)<0&&(o.append(`<input id="s2_${t.fK_S2id}" type="radio" class="btn-check" name="S2_Radio" autocomplete="off" value="${t.fK_S2id}" ${e}>`),o.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s2_'+t.fK_S2id+'">'+t.s2_Title+"</label>"),s2_list.push(t.fK_S2id)):!s2>=0&&(s2=0)})),r?$counter_input.removeClass("isEmpty"):($("#Product .content .options").addClass("d-none"),$(".btn_addToCar").addClass("close")),$options.prepend(n),$options.prepend(a),$radio=$("#Product > .content > .options > .radio"),$radio.each((function(){$input=$(this).children(".spec_control").children("input"),$input.each((function(){$(this).on("change",SpecRadio)}))})),$pro_discount.text(d.toLocaleString("en-US"))}else{s1=t.stocks[0].fK_S1id,s2=t.stocks[0].fK_S2id;var c=t.stocks[0].prices[0].price;$pro_discount.text(c.toLocaleString("en-US"))}t.stocks.length>0&&($input_quantity.attr({min:0,max:t.stocks[0].stock-t.stocks[0].stock%t.stocks[0].min_Qty,step:t.stocks[0].min_Qty}),t.stocks[0].stock>0&&($counter_input.removeClass("isEmpty"),$input_quantity.trigger("change")));var p=$(".ProductSwiper > .swiper-wrapper"),u=$(".PreviewSwiper > .swiper-wrapper");t.id,t.img_Medium.forEach((t=>{var e=$($("#TemplateImageSlide").html()).clone(),i=e.find(".pro_display");if(i.attr({alt:t.name,"data-id":t.id}),4===t.fileType)i.attr({"data-display-protype":"youtube","data-youtube-link":t.name,src:`https://img.youtube.com/vi/${t.name}/0.jpg`}),i.siblings(".schematic_image").replaceWith('<div class="schematic_youtube position-absolute"><i class="fa-brands fa-youtube"></i></div>');else i.attr("src",t.link[0]);i.imgCheck(),p.append(e)})),t.img_Small.forEach((t=>{var e=$($("#TemplatePreviewSlide").html()).clone(),i=e.find("img");if(i.attr("alt",t.name),4===t.fileType)i.attr({src:`https://img.youtube.com/vi/${t.name}/3.jpg`});else i.attr("src",t.link[0]);i.data("id",t.id),i.imgCheck(),u.append(e)})),1==t.img_Small.length&&$(".PreviewSwiper,.btn_swiper_prev_product,.btn_swiper_next_product").addClass("d-none"),t.img_Small.length>1&&(preview_swiper=new Swiper(".PreviewSwiper",{slidesPerView:4,loop:!1,spaceBetween:10,freeMode:!0,watchSlidesProgress:!0,scrollbar:{el:".swiper-scrollbar"},breakpoints:{576:{slidesPerView:4},768:{slidesPerView:6},992:{slidesPerView:8}}}),product_swiper=new Swiper(".ProductSwiper",{spaceBetween:15,loop:!0,navigation:{nextEl:".btn_swiper_next_product",prevEl:".btn_swiper_prev_product"},breakpoints:{768:{allowTouchMove:!0},992:{allowTouchMove:!1}},thumbs:{swiper:preview_swiper}})),p.find(".pro_display").on("click",ShowBigPro),img_origin_list=t.img_Original,t.tagDatas.length>0?t.tagDatas.forEach((t=>{$(".pro_tag").prepend(`<li><a class="round_tag rounded-pill me-1 px-3 py-1" href="/${OrgName}/Search/Get/3/${t.tag_Name}">${t.tag_Name}</a></li>`)})):$(".pro_tag").addClass("d-none"),null!=t.files&&t.files.length>0?t.files.forEach((function(t){var e=1==IsFaPage?t.link:t.link.replace("upload",`upload/${OrgName}`);$("#FileDownload>.File_list").append(`\n            <div class="file border-bottom">\n                <a href="${e}" download="${t.name}" title="${t.name}" class="link_with_icon d-flex text-decoration-none edit_lock">\n                    <div draggable="true" class="icon pe-2"></div>\n                    <div draggable="true" class="name">${t.name}\n                </div></a>\n            </div>`)})):$("#btn_tab > .files,#FileDownload").remove(),$("#btn_tab>li>button").first().trigger("click"),LinkWithIconInit()}function SpecRadioSet(t,e){var i=$($("#Template_Spec_Radio").html()).clone(),a=$($("#Template_Spec_Radio").html()).clone();i.find(".spec_control"),a.find(".spec_control")}function SpecRadio(){switch($self=$(this),$self_p=$self.parents(".radio").first(),$self_s=$self_p.siblings(".radio"),$input_quantity.val(1),$self_p.data("stype")){case 1:s1=$self.val();var t=[];price_list.forEach((function(e){e.s1id==s1&&t.push(e.s2id)})),CanShop&&$self_s.find("input").attr("disabled","disabled");var e=$self_s.find("input").length;$self_s.find("input").each((function(){$radio=$(this),t.indexOf(parseInt($radio.val()))>-1&&price_list.find((t=>t.s1id==s1&&t.s2id==$radio.val())).stock>0&&($radio.removeAttr("disabled"),e-=1)})),e==$self_s.find("input").length&&($(".btn_addToCar").addClass("close"),$counter_input.addClass("isEmpty")),"disabled"==$self_s.find("input[value='"+parseInt(s2)+"']").attr("disabled")&&(s2=null);var i=$self_s.find("input:checked");i.length>0&&void 0===i.attr("disabled")||($self_s.find("input").prop("checked",!1),$self_s.find("input:not([disabled])").length>0&&0==$self_s.find("input:not([disabled]):checked").length&&$self_s.find("input:not([disabled])").first().prop("checked",!0).trigger("change"));break;case 2:s2=$self.val();t=[];price_list.forEach((function(e){e.s2id==s2&&t.push(e.s1id)})),"disabled"==$self_s.find("input[value='"+parseInt(s2)+"']").attr("disabled")&&(s1=null);e=0;$self_s.find("input").each((function(){$radio=$(this);var t=price_list.find((t=>t.s1id==$radio.val()&&t.s2id==s2));void 0!==t&&t.stock<=0&&CanShop?($radio.attr("disabled","disabled"),e+=1):$radio.removeAttr("disabled")})),e==$self_s.find("input").length&&($(".btn_addToCar").hasClass("close")||$(".btn_addToCar").addClass("close"),$counter_input.hasClass("isEmpty")||$counter_input.addClass("isEmpty"))}null!=s1&&price_list.forEach((function(t){t.s1id!=s1||0!=t.s2id&&t.s2id!=s2||($pro_discount.text(t.price.toLocaleString("en-US")),$input_quantity.attr({min:0,max:t.stock-t.stock%t.minQty,step:t.minQty}),t.stock<=0?$counter_input.addClass("isEmpty"):$counter_input.removeClass("isEmpty"),$input_quantity.trigger("change"))})),null==s2&&(s2=0);var a=price_list.find((t=>t.s1id==s1&&t.s2id==s2));a.stock<=0?$(".btn_addToCar").hasClass("close")||$(".btn_addToCar").addClass("close"):($(".btn_addToCar").removeClass("close"),$input_quantity.attr("max",a.stock))}function AddToCart(){localStorage.getItem("AgreePrivacy")?null!=s1&&null!=s2&&0!=$input_quantity.val()?Product.AddUp.Cart({FK_Pid:parseInt(Pid),FK_S1id:s1,FK_S2id:s2,Quantity:$input_quantity.val(),Discont:0,Bonus:0,PriceType:0,IsAdditional:!1,Ser_No:500}).done((function(t){if(t.success){Coker.sweet.success("商品已成功加入購物車",null,!0);var e=t.message.substr(0,1),i=t.message.substr(1);if(Product.GetOne.Cart(i).done((function(t){"N"==e?CartDropAdd(t):CartDropUpdate(t)})),price_list.length>0){var a=price_list.find((t=>t.s1id==s1&&t.s2id==s2));a.stock-=$input_quantity.val(),$input_quantity.attr("max",a.stock),a.stock<=0&&($(".btn_addToCar").hasClass("close")||$(".btn_addToCar").addClass("close"),$counter_input.hasClass("isEmpty")||$counter_input.addClass("isEmpty"))}else{var n=$input_quantity.attr("max")-$input_quantity.val();n<=0?($(".btn_addToCar").hasClass("close")||$(".btn_addToCar").addClass("close"),$counter_input.hasClass("isEmpty")||$counter_input.addClass("isEmpty")):$input_quantity.attr("max",n)}$input_quantity.val(1)}else Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})):Coker.sweet.error("錯誤","請確實選擇規格及購買數量",null,!1):Coker.sweet.error("錯誤","若要進行商品選購，請先同意隱私權政策",null,!1)}function ShowBigPro(){var t=$(this),e=$("#ProDisplayModal > .modal-dialog > .modal-content > .modal-body");switch(e.children(".pro_img").addClass("d-none"),e.children(".pro_youtube").addClass("d-none"),e.children(".pro_360view").addClass("d-none"),t.data("display-protype")){case"image":$(".modal-dialog").hasClass("ytshow")&&$(".modal-dialog").removeClass("ytshow"),e.children(".pro_img").removeClass("d-none"),addImage(t);break;case"youtube":$(".modal-dialog").hasClass("ytshow")||$(".modal-dialog").addClass("ytshow"),e.children(".pro_youtube").removeClass("d-none"),addYoutube(t);break;case"360view":$(".modal-dialog").hasClass("ytshow")&&$(".modal-dialog").removeClass("ytshow"),e.children(".pro_360view").removeClass("d-none"),add360View(t)}}function addImage(t){var e=img_origin_list.find((e=>e.id==t.data("id"))).link[0];pro_folder=e.substr(0,e.lastIndexOf("/")+1),e=e.substr(e.lastIndexOf("/")+1),$("#Pro_Image").attr({"data-filename-x":e,"data-folder":pro_folder}),$("#ProDisplayModal").on("shown.bs.modal",(function(){document.getElementById("Pro_Image").classList.add("cloudimage-360"),window.CI360.add("Pro_Image")}))}function addYoutube(t){var e=t.data("youtube-link");$("#Pro_Youtube").attr("src","https://www.youtube-nocookie.com/embed/"+e)}function add360View(t){var e=$("#Pro_360View");e.attr("data-filename-x",t.data("filename-x")),e.attr("data-amount-x",t.data("amount-x")),$("#ProDisplayModal").on("shown.bs.modal",(function(){document.getElementById("Pro_360View").classList.add("cloudimage-360"),window.CI360.add("Pro_360View")}))}