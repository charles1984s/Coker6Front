var $input_quantity,Pid,s1,s2,spectype_list,spec_list,img_origin_list,preview_swiper,product_swiper,$pro_itemNo,s1_list=[],s2_list=[],price_list=[];const showRange=!1;function PageReady(){if(ElementInit(),window.CI360.init(),Pid=null==ProdId||isNaN(ProdId)?location.pathname.substring(location.pathname.lastIndexOf("/")+1):ProdId,isNaN(Pid)&&/\/[\d]+\//.test(location.pathname)){const e=location.pathname.match(/\/[\d]+\//g);e.length>0&&(Pid=e[e.length-1].replace(/\//g,""))}Product.GetOne.ProdMainDisplay(Pid).done((function(e){null!=e?PageDefaultSet(e):window.location.href=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"))})),$(".pro_display").on("click",ShowBigPro);document.getElementById("ProDisplayModal").addEventListener("hidden.bs.modal",(e=>{window.CI360.destroy(),$("#Pro_Youtube").attr("src","")})),$("#shareBlock").cShare({description:"jQuery plugin - C Share buttons",showButtons:["fb","line","plurk","twitter","email"]}),$(document).on("click",".btn_count_plus",(function(){$input_quantity.val(parseInt($input_quantity.val())+1)})),$(document).on("click",".btn_count_minus",(function(){$input_quantity.val(parseInt($input_quantity.val())-1),0==$input_quantity.val()&&$input_quantity.val(1)}));var e=$("#Product > .content > .options > .radio > .control");e.children().length<=2&&e.children("label").toggleClass("pe-none"),$(".btn_addToCar").on("click",AddToCart),$(".btn_tc").on("click",(function(){$("#ProductDescription").removeClass("active show"),$("#TechnicalDocuments").addClass("active show"),$("#pills-description-tab").removeClass("active"),$("#pills-documents-tab").addClass("active");var e=$(this).data("tcid");$(".badge_directions").each((function(){var t=$(this);t.data("pro_tc")==e&&$("html, body").animate({scrollTop:t.offset().top-2*$("header").height()},0)}))}))}function ElementInit(){$input_quantity=$(".input_pro_quantity"),$prod_content=$("#Product > .content"),$pro_name=$prod_content.find(".pro_title"),$pro_itemNo=$prod_content.find(".pro_itemNo"),$pro_introduce=$prod_content.find(".introduce"),$pro_specification=$prod_content.find(".specification").children("ul"),$pro_price=$prod_content.find(".ori_price"),$pro_discount=$prod_content.find(".discount"),$btn_detailed=$prod_content.find(".btn_detailed"),$options=$prod_content.find(".options")}function PageDefaultSet(e){$pro_name.text(e.title),$pro_itemNo.text(e.itemNo),$pro_introduce.append("<li>"+e.introduction.replaceAll("\n","</li><li>")+"</li>"),$pro_specification.append("<li>"+e.description.replaceAll("\n","</li><li>")+"</li>");var t=0;$pro_specification.children("li").each((function(){t+=$(this).height()})),t>$pro_specification.height()&&$btn_detailed.removeClass("d-none"),null!=e.html&&""!=e.html.trim()?$("#ProductDescription > Content").removeClass("d-none").html($.htmlDecode(e.html)):$("#ProductDescription,#btn_tab .description").remove(),e.techCertDatas.forEach((e=>{e.img_small.length>0?(e.img_small.forEach((function(t){$(".pro_tc > ul").append(`<li class="me-1"><button class="btn_tc bg-transparent border-0" data-tcid="${e.id}"><img src="${t.link}" alt="${t.name}" /></button></li>`),$(".pro_tc > ul img").imgCheck()})),e.img_orig.forEach((function(t){$(".pro_tc_content > .techcert_list").append(`<div class="badge_${e.id} row pb-3">\n\t\t\t                                                      <div class="col-12 col-lg-2 col-md-5 text-center verticalAlign">\n\t\t\t\t                                                      <img class="" src="${t.link}" alt="${t.name}" />\n\t\t\t                                                      </div>\n\t\t\t                                                      <div class="description align-self-center col">${e.description}</div>\n\t\t                                                      </div>\n\t\t                                                      <hr class="m-1" />`),$(".pro_tc_content > .techcert_list img").imgCheck()}))):$(".pro_tc").addClass("d-none")})),0!=e.status&&$("#Product>.image").append(`<span class="status status${e.status}">${e.statusName}</span>`),$(".pro_tc").hasClass("d-none")||$(".btn_tc").on("click",(function(){$("#TabContent .tab-pane").removeClass("active show"),$("#TechnicalDocuments").addClass("active show"),$("#btn_tab .nav-link").removeClass("active"),$("#pills-documents-tab").addClass("active");var e=$(this);$("html, body").animate({scrollTop:$(`.badge_${e.data("tcid")}`).offset().top-2*$("header > nav").height()},0)})),0==e.techCertDatas.length&&$("#btn_tab > .technical,.pro_tc").remove();if(e.stocks.length>1){var i={},n=$($("#Template_Spec_Radio").html()).clone(),a=$($("#Template_Spec_Radio").html()).clone(),o=n.find(".spec_control"),s=a.find(".spec_control");n.data("stype",1),a.data("stype",2);var d=0,l=0;e.stocks.forEach((e=>{i.s1id=e.fK_S1id,i.s2id=e.fK_S2id,i.price=e.prices.find((e=>1==e.fK_RId)).price,price_list.push(i),d=i.price>d?i.price:d,l=i.price<l||0==l?i.price:l,i={},e.fK_S1id>0?s1_list.indexOf(e.fK_S1id)<0&&(o.append('<input id="s1_'+e.fK_S1id+'" type="radio" class="btn-check" name="S1_Radio" autocomplete="off" value="'+e.fK_S1id+'">'),o.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s1_'+e.fK_S1id+'">'+e.s1_Title+"</label>"),s1_list.push(e.fK_S1id)):!s1>=0&&(s1=0),e.fK_S2id>0?s2_list.indexOf(e.fK_S2id)<0&&(s.append('<input id="s2_'+e.fK_S2id+'" type="radio" class="btn-check" name="S2_Radio" autocomplete="off" value="'+e.fK_S2id+'">'),s.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s2_'+e.fK_S2id+'">'+e.s2_Title+"</label>"),s2_list.push(e.fK_S2id)):!s2>=0&&(s2=0)})),$options.prepend(a),$options.prepend(n),$radio=$("#Product > .content > .options > .radio"),$radio.each((function(){$input=$(this).children(".spec_control").children("input"),$input.each((function(){$(this).on("click",SpecRadio)}))})),$pro_discount.text(d.toLocaleString("en-US"))}else{s1=e.stocks[0].fK_S1id,s2=e.stocks[0].fK_S2id;var r=e.stocks[0].prices.find((e=>1==e.fK_RId)).price;$pro_discount.text(r.toLocaleString("en-US"))}var c=$(".ProductSwiper > .swiper-wrapper"),p=$(".PreviewSwiper > .swiper-wrapper");e.id,e.img_Medium.forEach((e=>{var t=$($("#TemplateImageSlide").html()).clone(),i=t.find(".pro_display");if(i.attr({alt:e.name,"data-id":e.id}),4===e.fileType)i.attr({"data-display-protype":"youtube","data-youtube-link":e.name,src:`https://img.youtube.com/vi/${e.name}/0.jpg`});else i.attr("src",e.link[0]);i.imgCheck(),c.append(t)})),e.img_Small.forEach((e=>{var t=$($("#TemplatePreviewSlide").html()).clone(),i=t.find("img");if(i.attr("alt",e.name),4===e.fileType)i.attr({src:`https://img.youtube.com/vi/${e.name}/3.jpg`});else i.attr("src",e.link[0]);i.data("id",e.id),i.imgCheck(),p.append(t)})),1==e.img_Small.length&&$(".PreviewSwiper,.btn_swiper_prev_product,.btn_swiper_next_product").addClass("d-none"),e.img_Small.length>1&&(preview_swiper=new Swiper(".PreviewSwiper",{slidesPerView:4,loop:!1,spaceBetween:10,freeMode:!0,watchSlidesProgress:!0,scrollbar:{el:".swiper-scrollbar"},breakpoints:{576:{slidesPerView:4},768:{slidesPerView:6},992:{slidesPerView:8}}}),product_swiper=new Swiper(".ProductSwiper",{spaceBetween:15,loop:!0,navigation:{nextEl:".btn_swiper_next_product",prevEl:".btn_swiper_prev_product"},breakpoints:{768:{allowTouchMove:!0},992:{allowTouchMove:!1}},thumbs:{swiper:preview_swiper}})),c.find(".pro_display").on("click",ShowBigPro),img_origin_list=e.img_Original,e.tagDatas.length>0?e.tagDatas.forEach((e=>{$(".pro_tag").prepend(`<li><a class="round_tag rounded-pill me-1 px-3 py-1" href="/${OrgName}/Search/Get/3/${e.tag_Name}">${e.tag_Name}</a></li>`)})):$(".pro_tag").addClass("d-none"),null!=e.files&&e.files.length>0?e.files.forEach((function(e){var t=1==IsFaPage?e.link:e.link.replace("upload",`upload/${OrgName}`);$("#FileDownload>.File_list").append(`\n            <div class="file border-bottom">\n                <a href="${t}" download="${e.name}" title="${e.name}" class="link_with_icon d-flex text-decoration-none edit_lock">\n                    <div draggable="true" class="icon pe-2"></div>\n                    <div draggable="true" class="name">${e.name}\n                </div></a>\n            </div>`)})):$("#btn_tab > .files,#FileDownload").remove(),$("#btn_tab>li>button").first().trigger("click"),LinkWithIconInit()}function SpecRadio(){switch($self=$(this),$self_p=$self.parents(".radio").first(),$self_s=$self_p.siblings(".radio"),$self_p.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_s.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_p.data("stype")){case 1:s1=$self.val();var e=[];price_list.forEach((function(t){t.s1id==s1&&e.push(t.s2id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),e.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(s2)+"']").attr("disabled")&&(s2=null);break;case 2:s2=$self.val();e=[];price_list.forEach((function(t){t.s2id==s2&&e.push(t.s1id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),e.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(s2)+"']").attr("disabled")&&(s1=null)}null!=s1&&null!=s2&&price_list.forEach((function(e){e.s1id==s1&&e.s2id==s2&&$pro_discount.text(e.price.toLocaleString("en-US"))}))}function AddToCart(){null==$.cookie("cookie")||"reject"==$.cookie("cookie")?Coker.sweet.error("錯誤","若要進行商品選購，請先同意隱私權政策",null,!1):null!=s1&&null!=s2?Product.AddUp.Cart({FK_Tid:$.cookie("Token"),FK_Pid:parseInt(Pid),FK_S1id:s1,FK_S2id:s2,Quantity:$input_quantity.val(),Discont:0,Bonus:0,PriceType:0,IsAdditional:!1,Ser_No:500}).done((function(e){if(e.success){Coker.sweet.success("商品已成功加入購物車",null,!0);var t=e.message.substr(0,1),i=e.message.substr(1);Product.GetOne.Cart(i).done((function(e){"N"==t?CartDropAdd(e):CartDropUpdate(e)}))}else Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})):Coker.sweet.error("錯誤","請確實選擇規格",null,!1)}function ShowBigPro(){var e=$(this),t=$("#ProDisplayModal > .modal-dialog > .modal-content > .modal-body");switch(t.children(".pro_img").addClass("d-none"),t.children(".pro_youtube").addClass("d-none"),t.children(".pro_360view").addClass("d-none"),console.log(e.data("display-protype")),e.data("display-protype")){case"image":t.children(".pro_img").removeClass("d-none"),addImage(e);break;case"youtube":t.children(".pro_youtube").removeClass("d-none"),addYoutube(e);break;case"360view":t.children(".pro_360view").removeClass("d-none"),add360View(e)}}function addImage(e){var t=img_origin_list.find((t=>t.id==e.data("id"))).link[0];pro_folder=t.substr(0,t.lastIndexOf("/")+1),t=t.substr(t.lastIndexOf("/")+1),$("#Pro_Image").attr({"data-filename-x":t,"data-folder":pro_folder}),$("#ProDisplayModal").on("shown.bs.modal",(function(){document.getElementById("Pro_Image").classList.add("cloudimage-360"),window.CI360.add("Pro_Image")}))}function addYoutube(e){var t=e.data("youtube-link");$("#Pro_Youtube").attr("src","https://www.youtube.com/embed/"+t)}function add360View(e){var t=$("#Pro_360View");t.attr("data-filename-x",e.data("filename-x")),t.attr("data-amount-x",e.data("amount-x")),$("#ProDisplayModal").on("shown.bs.modal",(function(){document.getElementById("Pro_360View").classList.add("cloudimage-360"),window.CI360.add("Pro_360View")}))}