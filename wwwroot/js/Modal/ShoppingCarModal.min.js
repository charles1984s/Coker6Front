var $modal,$input_quantity,modal_s1,modal_s2,modal_hass1=!1,modal_hass2=!1,modal_price_list=[],modal_s1_list=[],modal_s2_list=[];modal_price_list=[];function ShoppingCarModalInit(){ModalElementInit();const t=document.getElementById("ShoppingCarModal");t.addEventListener("shown.bs.modal",(()=>{})),t.addEventListener("hidden.bs.modal",(()=>{DataClear()})),$(".btn_count_plus").on("click",(function(){$input_quantity.val(parseInt($input_quantity.val())+1)})),$(".btn_count_minus").on("click",(function(){$input_quantity.val()>1&&$input_quantity.val(parseInt($input_quantity.val())-1)}));var o=$(".options > .radio > .control");o.children().length<=2&&o.children("label").toggleClass("pe-none"),$(".btn_addToCar").on("click",(function(){$(".btn_addToCar").hasClass("close")||AddToCart()}))}function ModalElementInit(){$modal=$(".Modal"),$input_quantity=$(".input_pro_quantity"),$content=$(".Modal > .modal-content > .modal-body > .content"),$pro_image=$content.find(".pro_image"),$pro_name=$content.find(".name"),$pro_introduction=$content.find(".introduction"),$pro_price=$content.find(".ori_price"),$pro_discount=$content.find(".discount"),$options=$content.find(".options")}function DataClear(){$input_quantity.val(1),$pro_image.attr("src",""),$pro_name.text(""),$pro_introduction.text(""),$pro_price.addClass("d-none"),$pro_price.text(""),$pro_discount.text(""),$options.children(".radio").remove(),modal_hass1=!1,modal_hass2=!1,modal_s1=null,modal_s2=null,modal_s1_list=[],modal_s2_list=[],modal_price_list=[]}function ModalDefaultSet(){Product.GetOne.Prod($modal.data("pid")).done((function(t){$pro_image.attr("src","../upload/product/pro_0"+t.id+".png"),$pro_name.text(t.title),$pro_introduction.append("<div>．"+t.introduction.toString().replaceAll("\n","<br />．")+"</div>")})),Product.GetOne.Stock($modal.data("pid")).done((function(t){if(t.length>1){var o={},i=$($("#Modal_Template_Spec_Radio").html()).clone(),n=$($("#Modal_Template_Spec_Radio").html()).clone(),a=i.find(".spec_control"),e=i.find(".spec_title"),d=n.find(".spec_control"),l=n.find(".spec_title");i.data("stype",1),n.data("stype",2),t.forEach((function(t){o.s1id=t.fK_S1id,o.s2id=t.fK_S2id,o.price=t.price,modal_price_list.push(o),o={},t.fK_S1id>0?(modal_hass1||(e.text(t.s1_Title),modal_hass1=!0),modal_s1_list.indexOf(t.fK_S1id)<0&&(a.append('<input id="s1_'+t.fK_S1id+'" type="radio" class="btn-check" name="S1_Radio" autocomplete="off" value="'+t.fK_S1id+'">'),a.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s1_'+t.fK_S1id+'">'+t.s1_Name+"</label>"),modal_s1_list.push(t.fK_S1id))):!modal_s1>=0&&(modal_s1=0),t.fK_S2id>0?(modal_hass2||(l.text(t.s2_Title),modal_hass2=!0),modal_s2_list.indexOf(t.fK_S2id)<0&&(d.append('<input id="s2_'+t.fK_S2id+'" type="radio" class="btn-check" name="S2_Radio" autocomplete="off" value="'+t.fK_S2id+'">'),d.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s2_'+t.fK_S2id+'">'+t.s2_Name+"</label>"),modal_s2_list.push(t.fK_S2id))):!modal_s2>=0&&(modal_s2=0)})),$options.prepend(n),$options.prepend(i),$radio=$(".Modal > .modal-content > .modal-body > .content > .options > .radio"),$radio.each((function(){$input=$(this).children(".spec_control").children("input"),$input.each((function(){$(this).on("click",ModalSpecRadio)}))})),$pro_discount.text(t[0].price.toLocaleString("en-US")+" ~ "+t[t.length-1].price.toLocaleString("en-US"))}else modal_s1=t[0].fK_S1id,modal_s2=t[0].fK_S2id,$pro_discount.text(t[0].price.toLocaleString("en-US"))}))}function ModalSpecRadio(){switch($self=$(this),$self_p=$self.parents(".radio").first(),$self_s=$self_p.siblings(".radio"),$self_p.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_s.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_p.data("stype")){case 1:modal_s1=$self.val();var t=[];modal_price_list.forEach((function(o){o.s1id==modal_s1&&t.push(o.s2id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),t.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(modal_s2)+"']").attr("disabled")&&(modal_s2=null);break;case 2:modal_s2=$self.val();t=[];modal_price_list.forEach((function(o){o.s2id==modal_s2&&t.push(o.s1id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),t.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(modal_s2)+"']").attr("disabled")&&(modal_s1=null)}null!=modal_s1&&null!=modal_s2&&modal_price_list.forEach((function(t){t.s1id==modal_s1&&t.s2id==modal_s2&&$pro_discount.text(t.price.toLocaleString("en-US"))}))}function AddToCart(){null==$.cookie("cookie")?Coker.sweet.error("錯誤","若要進行商品選購，請先同意隱私權政策",null,!1):null!=modal_s1&&null!=modal_s2?Product.AddUp.Cart({FK_Tid:$.cookie("Token"),FK_Pid:$modal.data("pid"),FK_S1id:modal_s1,FK_S2id:modal_s2,Quantity:$input_quantity.val(),Discont:0,Bonus:0,PriceType:0,IsAdditional:!1,Ser_No:500}).done((function(t){if(t.success){Coker.sweet.success("商品已成功加入購物車",null,!0);var o=t.message.substr(0,1),i=t.message.substr(1);Product.GetOne.Cart(i).done((function(t){"N"==o?CartDropAdd(t):CartDropUpdate(t)}))}else Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})):Coker.sweet.error("錯誤","請確實選擇規格",null,!1)}