var $modal,$input_quantity,modal_s1,modal_s2,modal_hass1=!1,modal_hass2=!1,modal_price_list=[],modal_s1_list=[],modal_s2_list=[];modal_price_list=[];function ShoppingCarModalInit(){ModalElementInit();const o=document.getElementById("ShoppingCarModal");o.addEventListener("shown.bs.modal",(()=>{console.log($modal.data("pid"))})),o.addEventListener("hidden.bs.modal",(()=>{DataClear()})),$(".btn_count_plus").on("click",(function(){$input_quantity.val(parseInt($input_quantity.val())+1)})),$(".btn_count_minus").on("click",(function(){$input_quantity.val()>1&&$input_quantity.val(parseInt($input_quantity.val())-1)}));var t=$(".options > .radio > .control");t.children().length<=2&&t.children("label").toggleClass("pe-none"),$(".btn_addToCar").on("click",AddToCart)}function ModalElementInit(){$modal=$(".Modal"),$input_quantity=$(".input_pro_quantity"),$content=$(".Modal > .modal-content > .modal-body > .content"),$pro_image=$content.find(".pro_image"),$pro_name=$content.find(".name"),$pro_introduction=$content.find(".introduction"),$pro_price=$content.find(".ori_price"),$pro_discount=$content.find(".discount"),$options=$content.find(".options")}function DataClear(){$input_quantity.val(1),$pro_image.attr("src",""),$pro_name.text(""),$pro_introduction.text(""),$pro_price.addClass("d-none"),$pro_price.text(""),$pro_discount.text(""),$options.children(".radio").remove(),modal_hass1=!1,modal_hass2=!1,modal_s1=null,modal_s2=null,modal_s1_list=[],modal_s2_list=[],modal_price_list=[]}function ModalDefaultSet(){Product.GetOne.Prod($modal.data("pid")).done((function(o){console.log(o),$pro_image.attr("src","../images/product/pro_0"+o.id+".png"),$pro_name.text(o.title),$pro_introduction.append("<div>．"+o.introduction.toString().replaceAll("\n","<br />．")+"</div>")})),Product.GetOne.Stock($modal.data("pid")).done((function(o){if(console.log(o),o.length>1){var t={},i=$($("#Modal_Template_Spec_Radio").html()).clone(),e=$($("#Modal_Template_Spec_Radio").html()).clone(),n=i.find(".spec_control"),a=i.find(".spec_title"),d=e.find(".spec_control"),l=e.find(".spec_title");i.data("stype",1),e.data("stype",2),o.forEach((function(o){t.s1id=o.fK_S1id,t.s2id=o.fK_S2id,t.price=o.price,modal_price_list.push(t),t={},o.fK_S1id>0?(modal_hass1||(a.text(o.s1_Title),modal_hass1=!0),modal_s1_list.indexOf(o.fK_S1id)<0&&(n.append('<input id="s1_'+o.fK_S1id+'" type="radio" class="btn-check" name="S1_Radio" autocomplete="off" value="'+o.fK_S1id+'">'),n.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s1_'+o.fK_S1id+'">'+o.s1_Name+"</label>"),modal_s1_list.push(o.fK_S1id))):!modal_s1>=0&&(modal_s1=0),o.fK_S2id>0?(modal_hass2||(l.text(o.s2_Title),modal_hass2=!0),modal_s2_list.indexOf(o.fK_S2id)<0&&(d.append('<input id="s2_'+o.fK_S2id+'" type="radio" class="btn-check" name="S2_Radio" autocomplete="off" value="'+o.fK_S2id+'">'),d.append('<label class="btn_radio me-2 my-1 px-3 py-1 align-self-center" for="s2_'+o.fK_S2id+'">'+o.s2_Name+"</label>"),modal_s2_list.push(o.fK_S2id))):!modal_s2>=0&&(modal_s2=0)})),$options.prepend(e),$options.prepend(i),$radio=$(".Modal > .modal-content > .modal-body > .content > .options > .radio"),$radio.each((function(){$input=$(this).children(".spec_control").children("input"),$input.each((function(){$(this).on("click",ModalSpecRadio)}))})),$pro_discount.text(o[0].price.toLocaleString("en-US")+" ~ "+o[o.length-1].price.toLocaleString("en-US"))}else modal_s1=o[0].fK_S1id,modal_s2=o[0].fK_S2id,$pro_discount.text(o[0].price.toLocaleString("en-US"))}))}function ModalSpecRadio(){switch($self=$(this),$self_p=$self.parents(".radio").first(),$self_s=$self_p.siblings(".radio"),$self_p.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_s.find("input").each((function(){$radio=$(this),$radio.removeAttr("disabled")})),$self_p.data("stype")){case 1:modal_s1=$self.val();var o=[];modal_price_list.forEach((function(t){t.s1id==modal_s1&&o.push(t.s2id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),o.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(modal_s2)+"']").attr("disabled")&&(modal_s2=null);break;case 2:modal_s2=$self.val();o=[];modal_price_list.forEach((function(t){t.s2id==modal_s2&&o.push(t.s1id)})),$self_s.find("input").attr("disabled","disabled"),$self_s.find("input").each((function(){$radio=$(this),o.indexOf(parseInt($radio.val()))>-1&&$radio.removeAttr("disabled")})),"disabled"==$self_s.find("input[value='"+parseInt(modal_s2)+"']").attr("disabled")&&(modal_s1=null)}null!=modal_s1&&null!=modal_s2&&modal_price_list.forEach((function(o){o.s1id==modal_s1&&o.s2id==modal_s2&&$pro_discount.text(o.price.toLocaleString("en-US"))}))}function AddToCart(){null==$.cookie("cookie")||"reject"==$.cookie("cookie")?Coker.sweet.error("錯誤","若要進行商品選購，請先同意隱私權政策",null,!1):null!=modal_s1&&null!=modal_s2?Product.AddUp.Cart({FK_Tid:$.cookie("Token"),FK_Pid:$modal.data("pid"),FK_S1id:modal_s1,FK_S2id:modal_s2,Quantity:$input_quantity.val(),Discont:0,Bonus:0,PriceType:0,IsAdditional:!1,Ser_No:500}).done((function(o){if(o.success){Coker.sweet.success("商品已成功加入購物車",null,!0);var t=o.message.substr(0,1),i=o.message.substr(1);Product.GetOne.Cart(i).done((function(o){"N"==t?CartDropAdd(o):CartDropUpdate(o)}))}else Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})).fail((function(){Coker.sweet.error("錯誤","商品加入購物車發生錯誤",null,!0)})):Coker.sweet.error("錯誤","請確實選擇規格",null,!1)}