var Directory={getDirectoryData:function(t){return $.ajax({url:"/api/Directory/GetReleInfo",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json"})},getDirectoryMenuData:function(t){return $.ajax({url:"/api/Directory/GetReleMenu",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json"})}};function initElemntAndLoadDir(t,e){const a=t||$(".catalog_frame,.menu_directory").first(),n=a.attr("data-dirid")>0?a.attr("data-dirid"):0;a.data("prevdirid",n);const i=void 0!==a.data("shownum")?a.data("shownum"):12,o=void 0!==a.data("maxlen")?a.data("maxlen"):0,d=e?e.toString():location.hash.replace("#","");void 0!==a.data("page")&&a.data("page")==d||(e=isNaN(d)||""==d?"1":d,a.find(".catalog>.template").remove(),DirectoryDataGet(a,{Ids:[n],SiteId:"undefined"==typeof SiteId?0:SiteId,Page:e,ShowNum:i,MaxLen:void 0===o?0:o}),a.data("page",e))}function DirectoryGetDataInit(){const t=$(".catalog_frame,.menu_directory").length;$(".catalog_frame").each((function(){const t=$(this),e=t.attr("data-dirid")>0?t.attr("data-dirid"):0;void 0!==t.data("prevdirid")&&e==t.data("prevdirid")||initElemntAndLoadDir($(this))})),$(".menu_directory").each((function(){var t=$(this),e=t.attr("data-dirid")>0?t.attr("data-dirid"):0;void 0!==t.data("prevdirid")&&e==t.data("prevdirid")||(t.data("prevdirid",e),t.find(".title").text(""),t.find(".accordion").empty(),Directory.getDirectoryMenuData({Id:e,WebsiteId:"undefined"!=typeof SiteId?SiteId:0}).done((function(e){void 0!==e&&(t.find(".title").text(e.title),$.each(e.children,(function(a,n){if(t.find(".title").text(e.title),null!=n.children){var i=$($("#TemplateAccordionItem").html()).clone();i.find(".sectitle").text(n.title),i.find(".accordion-header").attr("id",`secheader${n.Id}`),i.find(".accordion-collapse").attr({"aria-labelledby":`secheader${n.Id}`,id:`seccollapse${n.Id}`}),i.find(".accordion-button").attr({"data-bs-target":`#seccollapse${n.Id}`,"aria-controls":`seccollapse${n.Id}`});var o=i.find(".accordion-body");$.each(n.children,(function(t,e){o.append(`<a href="${e.routerName}" title="連結至：${e.title}" class="list-group-item list-group-item-action border-0 py-3">${e.title}</a>`)})),t.find(".accordion").append(i)}else{var d=`<div class="accordion-item border-0 border-bottom px-1"><a href="${n.routerName}" title="連結至：${n.title}" class="list-group-item border-0 py-3 custom_h5 text-black">${n.title}</a></div>`;t.find(".accordion").append(d)}})))})))})),1==t&&("onhashchange"in window?window.onhashchange=hashChangeDirectory:setInterval(hashChangeDirectory,1e3))}function hashChangeDirectory(t){t?(initElemntAndLoadDir(),t.preventDefault()):console.log("HashChange錯誤")}function DirectoryDataGet(t,e){const a=$(".catalog_frame,.menu_directory").length;let n=parseInt(e.Page);Directory.getDirectoryData(e).done((function(e){let i=2;t.find(".page-item").each((function(){var t=$(this);t.hasClass("btn_prev")||t.hasClass("btn_next")||t.remove()})),e.totalPage<=1?t.find(".page_btn").addClass("d-none"):t.find(".page_btn").removeClass("d-none"),n>e.totalPage?n=e.totalPage:n<1&&(n=1),1==n?t.find(".btn_prev").addClass("d-none"):t.find(".btn_prev").removeClass("d-none"),n==e.totalPage?t.find(".btn_next").addClass("d-none"):t.find(".btn_next").removeClass("d-none"),1!=n&&n!=e.totalPage||(i=4);for(var o=1;o<=e.totalPage;o++)1==o?o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>1</span></li>`):(t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="第一頁" data-page=${o}>1</button></li>`),n-i-1>0&&t.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>')):o==e.totalPage?o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>${e.totalPage}</span></li>`):(n+i+1<e.totalPage&&t.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>'),t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="最後一頁" data-page=${o}>${e.totalPage}</button></li>`)):o>=n-i&&o<=n+i&&(o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>${o}</span></li>`):t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="移動至第${o}頁" data-page=${o}>${o}</button></li>`));$(".btn_page").off("click").on("click",(function(){var e=$(this);n!=e.data("page")&&(n=e.data("page"),1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,n)),t.goTo()})),t.data("init")||(t.find(".btn_prev > button").on("click",(function(){n=parseInt(t.data("page"))-1,n>=1&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,$self.data("page"))),t.goTo()})),t.find(".btn_next > button").on("click",(function(){n=parseInt(t.data("page"))+1,n<=e.totalPage&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,$self.data("page"))),t.goTo()}))),t.data("init","true"),DirectoryDataInsert(t,e.releInfos)}))}function DirectoryDataInsert(t,e){const a=t.find(".templatecontent").html();null!=e&&e.forEach((function(e){var n=$(a).clone(),i=(window.location.pathname.indexOf(e.orgName)>0?window.location.pathname:"/"+e.orgName+window.location.pathname)+e.link;i=i.replace("//","/"),n.find("a").attr("href",i),n.find("a").attr("title",`連結至: ${e.title}`);var o=e.mainImage;if(("undefined"!=typeof IsFaPage&&"undefined"!=typeof OrgName&&"True"!=IsFaPage||"undefined"!=typeof OrgName&&OrgName!=e.orgName)&&(o=o.replace("upload",`upload/${e.orgName}`)),n.find("img").attr("src",o),n.find("img").attr("alt",`${e.title}的主要圖片`),n.find(".title").text(e.title),n.find(".description").text(e.description),t.find(".catalog").append(n),null!=e.nodeDate&&""!=e.nodeDate){var d=new Date(e.nodeDate);n.find(".date").text(`${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`),n.find(".date-month").text(`${d.getMonth()+1}月`),n.find(".date-monthyear").text(`${d.getMonth()+1}/${d.getFullYear()}`),d.getDate()<10?n.find(".date-day").text(`0${d.getDate()}`):n.find(".date-day").text(`${d.getDate()}`)}})),HoverEffectInit()}