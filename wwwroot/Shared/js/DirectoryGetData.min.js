var Directory={getDirectoryData:function(t){return $.ajax({url:"/api/Directory/GetReleInfo",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json"})},getDirectoryMenuData:function(t){return $.ajax({url:"/api/Directory/GetReleMenu",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(t),dataType:"json"})}};function initElemntAndLoadDir(t,e){const a=t||$(".catalog_frame").first(),n=a.attr("data-dirid")>0?a.attr("data-dirid"):0;a.data("prevdirid",n);const i=void 0!==a.data("shownum")?a.data("shownum"):12,d=void 0!==a.data("maxlen")?a.data("maxlen"):0,o=e?e.toString():location.hash.replace("#","");void 0!==a.data("page")&&a.data("page")==o||(e=isNaN(o)||""==o?"1":o,a.find(".catalog>.template").remove(),DirectoryDataGet(a,{Ids:[n],SiteId:"undefined"==typeof SiteId?0:SiteId,Page:e,ShowNum:i,MaxLen:void 0===d?0:d}),a.data("page",e))}function DirectoryGetDataInit(){const t=$(".catalog_frame").length;$(".catalog_frame").each((function(){const t=$(this),e=t.attr("data-dirid")>0?t.attr("data-dirid"):0;void 0!==t.data("prevdirid")&&e==t.data("prevdirid")||initElemntAndLoadDir($(this))})),$(".menu_directory").each((function(){var t=$(this),e=t.attr("data-dirid")>0?t.attr("data-dirid"):0;void 0!==t.data("prevdirid")&&e==t.data("prevdirid")||(t.data("prevdirid",e),t.find(".title").text(""),t.find(".accordion").empty(),Directory.getDirectoryMenuData({Id:e,WebsiteId:"undefined"!=typeof SiteId?SiteId:0}).done((function(e){if(void 0!==e){t.find(".title").text(e.title);const a=`#${t.find(".accordion").attr("id")}`;$.each(e.children,(function(n,i){if(t.find(".title").text(e.title),null!=i.children){var d=$($("#TemplateAccordionItem").html()).clone();d.find(".sectitle").text(i.title),d.find(".accordion-header").attr("id",`secheader${i.id}`);const e=d.find(".accordion-collapse").attr({"aria-labelledby":`secheader${i.id}`,id:`seccollapse${i.id}`,"data-bs-parent":`${a}`});d.find(".accordion-button").attr({"data-bs-target":`#seccollapse${i.id}`,"aria-controls":`seccollapse${i.id}`});var o=d.find(".accordion-body");$.each(i.children,(function(t,a){const n=$(`<a href="${a.routerName}" title="連結至：${a.title}" class="list-group-item list-group-item-action border-0 py-3">${a.title}</a>`);"undefined"!=typeof PageKey&&PageKey.toLowerCase()==a.routerName.toLowerCase()&&($(n).addClass("active"),$(e).collapse("show"),d.find(".accordion-header").addClass("active")),o.append(n)})),t.find(".accordion").append(d)}else{var r=$(`<div class="accordion-item border-0 border-bottom px-1"><a href="${i.routerName}" title="連結至：${i.title}" class="list-group-item border-0 py-3 custom_h5 text-black">${i.title}</a></div>`);"undefined"!=typeof PageKey&&PageKey.toLowerCase()==i.routerName.toLowerCase()&&$(r).find("a").addClass("active"),t.find(".accordion").append(r)}}))}})))})),1==t&&("onhashchange"in window?window.onhashchange=hashChangeDirectory:setInterval(hashChangeDirectory,1e3))}function hashChangeDirectory(t){t?(initElemntAndLoadDir(),t.preventDefault()):console.log("HashChange錯誤")}function DirectoryDataGet(t,e){const a=$(".catalog_frame").length;let n=parseInt(e.Page);"search"==t.data("type")&&$.extend(!0,e,{Type:"search",SearchText:t.data("search-text").toString(),StartDate:t.data("startDate"),EndDate:t.data("endDate")}),Directory.getDirectoryData(e).done((function(i){let d=2;"search"==e.Type&&$(".searchCount").text(i.totalCount),t.find(".page-item").each((function(){var t=$(this);t.hasClass("btn_prev")||t.hasClass("btn_next")||t.remove()})),i.totalPage<=1?t.find(".page_btn").addClass("d-none"):t.find(".page_btn").removeClass("d-none"),n>i.totalPage?n=i.totalPage:n<1&&(n=1),1==n?t.find(".btn_prev").addClass("d-none"):t.find(".btn_prev").removeClass("d-none"),n==i.totalPage?t.find(".btn_next").addClass("d-none"):t.find(".btn_next").removeClass("d-none"),1!=n&&n!=i.totalPage||(d=4);for(var o=1;o<=i.totalPage;o++)1==o?o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>1</span></li>`):(t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="第一頁" data-page=${o}>1</button></li>`),n-d-1>0&&t.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>')):o==i.totalPage?o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>${i.totalPage}</span></li>`):(n+d+1<i.totalPage&&t.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>'),t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="最後一頁" data-page=${o}>${i.totalPage}</button></li>`)):o>=n-d&&o<=n+d&&(o==n?t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${o}>${o}</span></li>`):t.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="移動至第${o}頁" data-page=${o}>${o}</button></li>`));$(".btn_page").off("click").on("click",(function(){var e=$(this);n!=e.data("page")&&(n=e.data("page"),1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,n)),t.goTo()})),t.data("init")||(t.find(".btn_prev > button").on("click",(function(){var e=$(this);n=parseInt(t.data("page"))-1,e.data("page",n),n>=1&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,e.data("page"))),t.goTo()})),t.find(".btn_next > button").on("click",(function(){var e=$(this);n=parseInt(t.data("page"))+1,e.data("page",n),n<=i.totalPage&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(t,e.data("page"))),t.goTo()}))),t.data("init","true"),DirectoryDataInsert(t,i.releInfos)}))}function DirectoryDataInsert(t,e){if(null==e)return;const a=t.find(".templatecontent").html(),n=t.find(".templatecontent-tag").html(),i="search"==t.data("type");0==e.length?t.find(".catalog").addClass("empty"):t.find(".catalog").removeClass("empty"),null!=e&&e.forEach((function(e){var d=$(a).clone();let o,r;if(i){if(3===e.type)o=`${null==e.orgName?"":`/${e.orgName}`}/${e.link}/${t.data("search-text")}`;else o=`${null==e.orgName?"":`/${e.orgName}`}/search/${e.link}/${t.data("search-text")}`;if(r="_blank",e.mainImage.indexOf("youtu")>0){var l="",s=e.mainImage.match(/^.*(?:(?:youtu.be\/|v\/|vi\/|u\/w\/|embed\/)|(?:(?:watch)??v(?:i)?=|&v(?:i)?=))([^#&?]*).*/);null!=s&&s.length>0&&(l=s[1]),e.mainImage="https://img.youtube.com/vi/"+l+"/mqdefault.jpg"}}else o=(window.location.pathname.indexOf(e.orgName)>0?window.location.pathname:`${null==e.orgName?"":`/${e.orgName}`}${window.location.pathname}`)+e.link,r="_self";1==e.type&&0!=e.status&&d.find("a").append(`<span class="status status${e.status}">${e.statusName}</span>`),o=o.replace("//","/");const c={href:o,title:`連結至: ${e.title}${"_blank"==r?"(另開視窗)":""}`,target:r};"A"==d[0].tagName?d.attr(c):d.find("a").attr(c);var g=e.mainImage||"/images/noImg.jpg";if(null!=e.orgName&&("undefined"!=typeof IsFaPage&&"undefined"!=typeof OrgName&&"True"!=IsFaPage||"undefined"!=typeof OrgName&&OrgName!=e.orgName)&&(g=g.replace("upload",`upload/${e.orgName}`)),d.find("img").attr("src",g),d.find("img").imgCheck().attr("alt",`${e.title}的主要圖片`),d.find(".title").text(e.title),d.find(".description").html(e.description),d.find(".location").length>0&&(null==e.location||""==e.location)?d.find(".location").parents(".py-2").remove():d.find(".location").text(e.location),d.find(".address").length>0&&(null==e.address||""==e.address)?d.find(".address").parents(".py-2").remove():d.find(".address").text(e.address),null!=e.startTime&&""!=e.startTime){var p=new Date(e.startTime);d.find(".startTime").text(`${p.getFullYear()}/${p.getMonth()+1}/${p.getDate()}`)}if(null!=e.nodeDate&&""!=e.nodeDate){var f=new Date(e.nodeDate);d.find(".date").text(`${f.getFullYear()}/${f.getMonth()+1}/${f.getDate()}`),d.find(".date-month").text(`${f.getMonth()+1}月`),d.find(".date-monthyear").text(`${f.getMonth()+1}/${f.getFullYear()}`),f.getDate()<10?d.find(".date-day").text(`0${f.getDate()}`):d.find(".date-day").text(`${f.getDate()}`),f.getMonth()<9?d.find(".date-month-number").text(`0${f.getMonth()+1}`):d.find(".date-month-number").text(`${f.getMonth()+1}`),d.find(".date-year").text(`${f.getFullYear()}`)}if(null!=e.price){const t=t=>t.includes("~")?([price_low,price_mid,price_high]=t.split(" "),price_high):t,a=e=>Intl.NumberFormat().format(t(e));if(d.find(".normal-price").text(a(e.price)),d.find(".price-grid").text(a(e.price)),d.find(".itemNo").text(e.itemNo),$tags=d.find(".tags"),$tags.empty(),e.tags.slice(0,2).forEach((t=>{let e=$(n).clone();e.text(t.tag_Name.slice(0,4)),$tags.append(e)})),e.tags.slice(2).forEach((t=>{let e=$(n).clone();e.text(t.tag_Name.slice(0,4)),e.addClass("more-tag d-none"),$tags.append(e)})),e.tags.length>2){let t=$(n).clone();t.text("..."),t.addClass("less-tag"),$tags.append(t)}}d.find(".shareBlock > a").remove(),d.find(".shareBlock").data("href",o),t.find(".catalog").append(d)})),HoverEffectInit(),ShareBlockInit()}