var Directory={getDirectoryData:function(e){return $.ajax({url:"/api/Directory/GetReleInfo",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json"})},getDirectoryMenuData:function(e){return $.ajax({url:"/api/Directory/GetReleMenu",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json"})},getDirectoryAdvertiseData:function(e){return $.ajax({url:"/api/Directory/GetReleAd",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json"})}};function initElemntAndLoadDir(e,t){console.log("InitLoad");const a=e||$(".catalog_frame").first();var n=a.find(".templatecontent").siblings();if(n.length>0)for(i=0;i<n.length;i++)n[i].remove();const o=void 0!==a.data("dirid")?"string"==typeof a.data("dirid")?a.data("dirid").split(","):[a.data("dirid")]:0;a.data("prevdirid",o);const d=void 0!==a.data("shownum")?a.data("shownum"):12,r=void 0!==a.data("maxlen")&&""!=a.data("maxlen")?a.data("maxlen"):0,l=t?t.toString():location.hash.replace("#",""),s=a.hasClass("getlatlng"),c=void 0!==a.data("longitude")?a.data("longitude"):null,p=void 0!==a.data("latitude")?a.data("latitude"):null;if(void 0===a.data("page")||a.data("page")!=l){t=isNaN(l)||""==l?"1":l;const i={Ids:o,SiteId:"undefined"==typeof SiteId?0:SiteId,Page:t,ShowNum:d,MaxLen:void 0===r?0:r,Filters:a.data("filtered"),directoryType:a.data("directoryTypeChecked"),target:void 0===a.data("target")?null:a.data("target"),FindNearest:s,Longitude:c,Latitude:p};console.log(i),a.find(".catalog>.template").remove(),DirectoryDataGet(a,i),a.off("filter").on("filter",(function(){a.removeData("page"),initElemntAndLoadDir(e,t)})),a.data("page",t)}}function DirectoryGetDataInit(){const e=$(".catalog_frame").length;$(".catalog_frame").each((function(){const e=$(this),t=void 0!==e.data("dirid")?"string"==typeof e.data("dirid")?e.data("dirid").split(","):[e.data("dirid")]:0;void 0!==e.data("prevdirid")&&t==e.data("prevdirid")||initElemntAndLoadDir($(this))})),$(".menu_directory").each((function(){var e=$(this);const t=void 0!==e.data("dirid")?"string"==typeof e.data("dirid")?e.data("dirid").split(","):[e.data("dirid")]:0;var a=void 0!==e.attr("data-show-unvisible")&&"true"==e.attr("data-show-unvisible").toLowerCase();void 0!==e.data("prevdirid")&&t==e.data("prevdirid")||(e.data("prevdirid",t),e.find(".title").text(""),e.find(".accordion").empty(),Directory.getDirectoryMenuData({Ids:t,WebsiteId:"undefined"!=typeof SiteId?SiteId:0,showUnvisible:a}).done((function(t){if(void 0!==t){e.find(".title").text(t.title);const a=`#${e.find(".accordion").attr("id")}`;$.each(t.children,(function(i,n){if(e.find(".title").text(t.title),null!=n.children){var o=$($("#TemplateAccordionItem").html()).clone();o.find(".sectitle").text(n.title),o.find(".accordion-header").attr("id",`secheader${n.id}`);const t=o.find(".accordion-collapse").attr({"aria-labelledby":`secheader${n.id}`,id:`seccollapse${n.id}`,"data-bs-parent":`${a}`});o.find(".accordion-button").attr({"data-bs-target":`#seccollapse${n.id}`,"aria-controls":`seccollapse${n.id}`});var d=o.find(".accordion-body");$.each(n.children,(function(e,a){const i=$(`<a href="${a.routerName}" title="連結至：${a.title}" class="list-group-item list-group-item-action border-0 py-3">${a.title}</a>`);"undefined"!=typeof PageKey&&PageKey.toLowerCase()==a.routerName.toLowerCase()&&($(i).addClass("active"),$(t).collapse("show"),o.find(".accordion-header").addClass("active")),d.append(i)})),e.find(".accordion").append(o)}else{const t=null!=n.routerName&&""!=n.routerName?n.routerName:n.linkUrl;var r=$(`<div class="accordion-item border-0 border-bottom px-1"><a href="${t}" title="連結至：${n.title}" class="list-group-item border-0 py-3 custom_h5 text-black"><span>${n.title}<span></a></div>`);if(null!=n.imgUrl&&""!=n.imgUrl){const e=$('<img alt=" " />');null==n.overImgUrl||"undefined"!=typeof PageKey&&t.toLowerCase().indexOf(PageKey.toLowerCase())>=0?e.attr("src",n.imgUrl):e.attr("src",n.overImgUrl),$(r).find("a").removeClass("py-3").addClass("p-0 imgMenu").append(e)}"undefined"!=typeof PageKey&&PageKey.toLowerCase()==n.routerName.toLowerCase()&&$(r).find("a").addClass("active"),e.find(".accordion").append(r)}})),$(".selectList").length>0&&$(window).trigger("resize.selectList")}})))})),$(".advertise_directory").each((function(){const e=$(this),t=void 0!==e.data("dirid")?"string"==typeof e.data("dirid")?e.data("dirid").split(","):[e.data("dirid")]:0;Directory.getDirectoryAdvertiseData({Ids:t,WebsiteId:"undefined"!=typeof SiteId?SiteId:0,showUnvisible:!0}).done((function(t){DirectoryAdDataInsert(e,t)}))})),1==e&&("onhashchange"in window?window.onhashchange=hashChangeDirectory:setInterval(hashChangeDirectory,1e3))}function hashChangeDirectory(e){e?(initElemntAndLoadDir(),e.preventDefault()):console.log("HashChange錯誤")}function DirectoryDataGet(e,t){console.log("DataGet");const a=$(".catalog_frame").length;let i=parseInt(t.Page);"search"==e.data("type")?$.extend(!0,t,{Type:"search",SearchText:e.data("search-text").toString(),StartDate:e.data("startDate"),EndDate:e.data("endDate")}):"undefined"!=e.data("type")&&$.extend(!0,t,{Type:e.data("type")}),Directory.getDirectoryData(t).done((function(n){let o=2;"search"==t.Type&&$(".searchCount").text(n.totalCount),e.find(".page-item").each((function(){var e=$(this);e.hasClass("btn_prev")||e.hasClass("btn_next")||e.remove()})),n.totalPage<=1?e.find(".page_btn").addClass("d-none"):e.find(".page_btn").removeClass("d-none"),i>n.totalPage?i=n.totalPage:i<1&&(i=1),1==i?e.find(".btn_prev").addClass("d-none"):e.find(".btn_prev").removeClass("d-none"),i==n.totalPage?e.find(".btn_next").addClass("d-none"):e.find(".btn_next").removeClass("d-none"),1!=i&&i!=n.totalPage||(o=4);for(var d=1;d<=n.totalPage;d++)1==d?d==i?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>1</span></li>`):(e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="第一頁" data-page=${d}>1</button></li>`),i-o-1>0&&e.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>')):d==n.totalPage?d==i?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>${n.totalPage}</span></li>`):(i+o+1<n.totalPage&&e.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>'),e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="最後一頁" data-page=${d}>${n.totalPage}</button></li>`)):d>=i-o&&d<=i+o&&(d==i?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>${d}</span></li>`):e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="移動至第${d}頁" data-page=${d}>${d}</button></li>`));if($(".btn_page").off("click").on("click",(function(){var t=$(this);i!=t.data("page")&&(i=t.data("page"),1==a&&window.location.hash!=`#${i}`?window.location.hash=`#${i}`:initElemntAndLoadDir(e,i)),e.goTo()})),e.data("init")||(e.find(".btn_prev > button").on("click",(function(){var t=$(this);i=parseInt(e.data("page"))-1,t.data("page",i),i>=1&&(1==a&&window.location.hash!=`#${i}`?window.location.hash=`#${i}`:initElemntAndLoadDir(e,t.data("page"))),e.goTo()})),e.find(".btn_next > button").on("click",(function(){var t=$(this);i=parseInt(e.data("page"))+1,t.data("page",i),i<=n.totalPage&&(1==a&&window.location.hash!=`#${i}`?window.location.hash=`#${i}`:initElemntAndLoadDir(e,t.data("page"))),e.goTo()}))),e.data("init","true"),DirectoryDataInsert(e,n.releInfos),e.data({filter:n.filter,directoryType:n.directoryType}).trigger("load"),e.hasClass("swiper")||e.find(".swiper").length>0||e.hasClass("swiper-wrapper")){let t;t=e.hasClass("swiper")?e:e.find(".swiper").length>0?e.find(".swiper"):e.parents(".swiper"),t.parents('[class*="_swiper"]').data("isInit",!1),SwiperInit({autoplay:!0})}}))}function DirectoryDataInsert(e,t){if(console.log("Insert"),null==t)return;const a=e.find(".templatecontent").html(),i=e.find(".templatecontent-tag").html(),n="search"==e.data("type"),o=void 0===e.data("dirpath")?"":e.data("dirpath").toLowerCase();0==t.length?e.find(".catalog").addClass("empty"):e.find(".catalog").removeClass("empty"),null!=t&&t.forEach((function(t){var d=$(a).clone();let r,l;if(n||window.location.pathname.toLowerCase().indexOf("search")>0||window.location.pathname.toLowerCase().indexOf("techcert")>0){if(3===t.type)r=`${null==t.orgName?"":`/${t.orgName}`}/${t.link}`;else r=`${null==t.orgName?"":`/${t.orgName}`}/search/${t.link}`;if(void 0!==e.data("search-text")&&""!=e.data("search-text")&&(r=`${r}/${e.data("search-text")}`),l="_blank",t.mainImage.indexOf("youtu")>0){var s="",c=t.mainImage.match(/^.*(?:(?:youtu.be\/|v\/|vi\/|u\/w\/|embed\/)|(?:(?:watch)??v(?:i)?=|&v(?:i)?=))([^#&?]*).*/);null!=c&&c.length>0&&(s=c[1]),t.mainImage="https://img.youtube.com/vi/"+s+"/mqdefault.jpg"}}else r=(window.location.pathname.indexOf(t.orgName)>0&&window.location.pathname.toLowerCase().indexOf("home")<0&&window.location.pathname.toLowerCase().indexOf(o)>=0?window.location.pathname:`${null==t.orgName?"":`/${t.orgName}`}${""==o?null==t.orgName?window.location.pathname:window.location.pathname.toLowerCase().replace(`${t.orgName.toLowerCase()}`,""):`/${o}`}`)+t.link,l="_self";1==t.type&&0!=t.status&&d.find("a").append(`<span class="status status${t.status}">${t.statusName}</span>`),/^http/.test(r)||(r=r.replace("//","/"));const p={href:r,title:`連結至: ${t.title}${"_blank"==l?"(另開視窗)":""}`,target:l};d.length>0&&("A"==d[0].tagName?d.attr(p):d.find("a").attr(p)),e.hasClass("cross_graphics_frame")&&""==t.mainImage&&d.children("div:first").addClass("d-none"),e.hasClass("getlatlng")&&(d.find(".dirname").text(t.dirname),d.find(".dirname").removeClass("d-none"));var g=t.mainImage||"/images/noImg.jpg";if(null!=t.orgName&&("undefined"!=typeof IsFaPage&&"undefined"!=typeof OrgName&&!IsFaPage||"undefined"!=typeof OrgName&&OrgName!=t.orgName)&&(g=g.replace("upload",`upload/${t.orgName}`)),d.find("img").attr("src",g),d.find("img").imgCheck().attr("alt",`${t.title}的主要圖片`),d.find(".title").text(t.title),d.find(".subtitle").text(t.subtitle),d.find(".description").html(t.description),d.find(".location").length>0&&(null==t.location||""==t.location)?d.find(".location").parents(".py-2").remove():d.find(".location").text(t.location),d.find(".address").length>0&&(null==t.address||""==t.address)?d.find(".address").parents(".py-2").remove():d.find(".address").text(t.address),null!=t.startTime&&""!=t.startTime){var f=new Date(t.startTime);d.find(".startTime").text(`${f.getFullYear()}/${f.getMonth()+1}/${f.getDate()}`)}else d.find(".startTime").each(((e,t)=>{"span"==t.tagName.toLowerCase()?$(t).parent().remove():$(t).remove()}));if(null!=t.nodeDate&&""!=t.nodeDate){var h=new Date(t.nodeDate);d.find(".date").text(`${h.getFullYear()}/${h.getMonth()+1}/${h.getDate()}`),d.find(".date-month").text(`${h.getMonth()+1}月`),d.find(".date-monthyear").text(`${h.getMonth()+1}/${h.getFullYear()}`),h.getDate()<10?d.find(".date-day").text(`0${h.getDate()}`):d.find(".date-day").text(`${h.getDate()}`),h.getMonth()<9?d.find(".date-month-number").text(`0${h.getMonth()+1}`):d.find(".date-month-number").text(`${h.getMonth()+1}`),d.find(".date-year").text(`${h.getFullYear()}`)}else d.find(".date,.date-month,date-monthyear,date-day").each(((e,t)=>{"span"==t.tagName.toLowerCase()?$(t).parent().remove():$(t).remove()}));if(null!=t.price){const e=e=>e.includes("~")?([price_low,price_mid,price_high]=e.split(" "),price_high):e,a=t=>Intl.NumberFormat().format(e(t));if(d.find(".normal-price").text(a(t.price)),d.find(".price-grid").text(a(t.price)),null!=t.itemNo&&""!=t.itemNo?d.find(".itemNo").text(t.itemNo):d.find(".itemNo").remove(),$tags=d.find(".tags"),$tags.empty(),t.tags.slice(0,2).forEach((e=>{let t=$(i).clone();t.text(e.tag_Name.slice(0,4)),$tags.append(t)})),t.tags.slice(2).forEach((e=>{let t=$(i).clone();t.text(e.tag_Name.slice(0,4)),t.addClass("more-tag d-none"),$tags.append(t)})),t.tags.length>2){let e=$(i).clone();e.text("..."),e.addClass("less-tag"),$tags.append(e)}$tags.children().each((function(){$(this).on("click",(function(){return location.href=`/${OrgName}/Search/Get/3/${$(this).text()}`,!1}))}))}else d.find(".itemNo,.price").remove();d.find(".shareBlock").data("init",!1),d.find(".shareBlock > a").remove(),d.find(".shareBlock").data("href",r),e.find(".catalog").append(d)})),HoverEffectInit(),ShareBlockInit()}function DirectoryAdDataInsert(e,t){console.log(e),console.log(t),e.children(".File_Frame").each((function(e){var a=$(this),i=t[e],n=t[e].fileLink.fileType;if(0==a.data("type")||a.data("type")==n){console.log(n);var o=i.target?"(開新分頁)":"";switch(parseInt(n)){case 1:var d=`<a href="${i.link} target="${i.target}" title="連結至：${i.link}${o}" ><img src="${i.fileLink.link}" alt="${i.title}圖片"  class="w-100"/></a>`;a.find(".frame").append(d);break;case 2:d=`<video class="w-100" controls src="${i.fileLink.link}" type="${i.fileLink.video_Type}"></video>`;a.find(".frame").append(d);break;case 3:d=`<iframe src="https://www.youtube.com/embed/${i.fileLink.name}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;a.find(".frame").append(d)}if(a.find(".title").text(i.title),a.find(".tag").length>0){var r="";$.each(i.tagDatas,(function(e,t){r+="#"+t.title})),a.find(".tag").text(r)}}}))}