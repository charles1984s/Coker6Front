var Directory={getDirectoryData:function(e){return $.ajax({url:"/api/Directory/GetReleInfo",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json"})},getDirectoryMenuData:function(e){return $.ajax({url:"/api/Directory/GetReleMenu",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(e),dataType:"json"})}};function initElemntAndLoadDir(e,t){const a=e||$(".catalog_frame").first(),n=a.attr("data-dirid")>0?a.attr("data-dirid"):0;a.data("prevdirid",n);const i=void 0!==a.data("shownum")?a.data("shownum"):12,o=void 0!==a.data("maxlen")?a.data("maxlen"):0,d=t?t.toString():location.hash.replace("#","");if(void 0===a.data("page")||a.data("page")!=d){t=isNaN(d)||""==d?"1":d;const r={Ids:[n],SiteId:"undefined"==typeof SiteId?0:SiteId,Page:t,ShowNum:i,MaxLen:void 0===o?0:o,Filters:a.data("filtered"),directoryType:a.data("directoryTypeChecked")};a.find(".catalog>.template").remove(),DirectoryDataGet(a,r),a.off("filter").on("filter",(function(){a.removeData("page"),initElemntAndLoadDir(e,t)})),a.data("page",t)}}function DirectoryGetDataInit(){const e=$(".catalog_frame").length;$(".catalog_frame").each((function(){const e=$(this),t=e.attr("data-dirid")>0?e.attr("data-dirid"):0;void 0!==e.data("prevdirid")&&t==e.data("prevdirid")||initElemntAndLoadDir($(this))})),$(".menu_directory").each((function(){var e=$(this),t=e.attr("data-dirid")>0?e.attr("data-dirid"):0,a=void 0!==e.attr("data-show-unvisible")&&"true"==e.attr("data-show-unvisible").toLowerCase();void 0!==e.data("prevdirid")&&t==e.data("prevdirid")||(e.data("prevdirid",t),e.find(".title").text(""),e.find(".accordion").empty(),Directory.getDirectoryMenuData({Id:t,WebsiteId:"undefined"!=typeof SiteId?SiteId:0,showUnvisible:a}).done((function(t){if(void 0!==t){e.find(".title").text(t.title);const a=`#${e.find(".accordion").attr("id")}`;$.each(t.children,(function(n,i){if(e.find(".title").text(t.title),null!=i.children){var o=$($("#TemplateAccordionItem").html()).clone();o.find(".sectitle").text(i.title),o.find(".accordion-header").attr("id",`secheader${i.id}`);const t=o.find(".accordion-collapse").attr({"aria-labelledby":`secheader${i.id}`,id:`seccollapse${i.id}`,"data-bs-parent":`${a}`});o.find(".accordion-button").attr({"data-bs-target":`#seccollapse${i.id}`,"aria-controls":`seccollapse${i.id}`});var d=o.find(".accordion-body");$.each(i.children,(function(e,a){const n=$(`<a href="${a.routerName}" title="連結至：${a.title}" class="list-group-item list-group-item-action border-0 py-3">${a.title}</a>`);"undefined"!=typeof PageKey&&PageKey.toLowerCase()==a.routerName.toLowerCase()&&($(n).addClass("active"),$(t).collapse("show"),o.find(".accordion-header").addClass("active")),d.append(n)})),e.find(".accordion").append(o)}else{const t=null!=i.routerName&&""!=i.routerName?i.routerName:i.linkUrl;var r=$(`<div class="accordion-item border-0 border-bottom px-1"><a href="${t}" title="連結至：${i.title}" class="list-group-item border-0 py-3 custom_h5 text-black"><span>${i.title}<span></a></div>`);if(null!=i.imgUrl&&""!=i.imgUrl){const e=$('<img alt=" " />');null==i.overImgUrl||"undefined"!=typeof PageKey&&t.toLowerCase().indexOf(PageKey.toLowerCase())>=0?e.attr("src",i.imgUrl):e.attr("src",i.overImgUrl),$(r).find("a").removeClass("py-3").addClass("p-0 imgMenu").append(e)}"undefined"!=typeof PageKey&&PageKey.toLowerCase()==i.routerName.toLowerCase()&&$(r).find("a").addClass("active"),e.find(".accordion").append(r)}})),$(".selectList").length>0&&$(window).trigger("resize.selectList")}})))})),1==e&&("onhashchange"in window?window.onhashchange=hashChangeDirectory:setInterval(hashChangeDirectory,1e3))}function hashChangeDirectory(e){e?(initElemntAndLoadDir(),e.preventDefault()):console.log("HashChange錯誤")}function DirectoryDataGet(e,t){const a=$(".catalog_frame").length;let n=parseInt(t.Page);"search"==e.data("type")?$.extend(!0,t,{Type:"search",SearchText:e.data("search-text").toString(),StartDate:e.data("startDate"),EndDate:e.data("endDate")}):"undefined"!=e.data("type")&&$.extend(!0,t,{Type:e.data("type")}),Directory.getDirectoryData(t).done((function(i){let o=2;"search"==t.Type&&$(".searchCount").text(i.totalCount),e.find(".page-item").each((function(){var e=$(this);e.hasClass("btn_prev")||e.hasClass("btn_next")||e.remove()})),i.totalPage<=1?e.find(".page_btn").addClass("d-none"):e.find(".page_btn").removeClass("d-none"),n>i.totalPage?n=i.totalPage:n<1&&(n=1),1==n?e.find(".btn_prev").addClass("d-none"):e.find(".btn_prev").removeClass("d-none"),n==i.totalPage?e.find(".btn_next").addClass("d-none"):e.find(".btn_next").removeClass("d-none"),1!=n&&n!=i.totalPage||(o=4);for(var d=1;d<=i.totalPage;d++)1==d?d==n?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>1</span></li>`):(e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="第一頁" data-page=${d}>1</button></li>`),n-o-1>0&&e.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>')):d==i.totalPage?d==n?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>${i.totalPage}</span></li>`):(n+o+1<i.totalPage&&e.find(".page_btn").children(".btn_next").before('<li class="page-item px-2">...</li>'),e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="最後一頁" data-page=${d}>${i.totalPage}</button></li>`)):d>=n-o&&d<=n+o&&(d==n?e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><span class="btn_page page-link text-black bg-secondary" data-page=${d}>${d}</span></li>`):e.find(".page_btn").children(".btn_next").before(`<li class="page-item"><button class="btn_page page-link text-black" title="移動至第${d}頁" data-page=${d}>${d}</button></li>`));$(".btn_page").off("click").on("click",(function(){var t=$(this);n!=t.data("page")&&(n=t.data("page"),1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(e,n)),e.goTo()})),e.data("init")||(e.find(".btn_prev > button").on("click",(function(){var t=$(this);n=parseInt(e.data("page"))-1,t.data("page",n),n>=1&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(e,t.data("page"))),e.goTo()})),e.find(".btn_next > button").on("click",(function(){var t=$(this);n=parseInt(e.data("page"))+1,t.data("page",n),n<=i.totalPage&&(1==a&&window.location.hash!=`#${n}`?window.location.hash=`#${n}`:initElemntAndLoadDir(e,t.data("page"))),e.goTo()}))),e.data("init","true"),DirectoryDataInsert(e,i.releInfos),e.data({filter:i.filter,directoryType:i.directoryType}).trigger("load")}))}function DirectoryDataInsert(e,t){if(null==t)return;const a=e.find(".templatecontent").html(),n=e.find(".templatecontent-tag").html(),i="search"==e.data("type"),o=void 0===e.data("dirpath")?"":e.data("dirpath").toLowerCase();0==t.length?e.find(".catalog").addClass("empty"):e.find(".catalog").removeClass("empty"),null!=t&&t.forEach((function(t){var d=$(a).clone();let r,l;if(i||window.location.pathname.toLowerCase().indexOf("search")>0||window.location.pathname.toLowerCase().indexOf("techcert")>0){if(3===t.type)r=`${null==t.orgName?"":`/${t.orgName}`}/${t.link}`;else r=`${null==t.orgName?"":`/${t.orgName}`}/search/${t.link}`;if(void 0!==e.data("search-text")&&""!=e.data("search-text")&&(r=`${r}/${e.data("search-text")}`),l="_blank",t.mainImage.indexOf("youtu")>0){var s="",c=t.mainImage.match(/^.*(?:(?:youtu.be\/|v\/|vi\/|u\/w\/|embed\/)|(?:(?:watch)??v(?:i)?=|&v(?:i)?=))([^#&?]*).*/);null!=c&&c.length>0&&(s=c[1]),t.mainImage="https://img.youtube.com/vi/"+s+"/mqdefault.jpg"}}else r=(window.location.pathname.indexOf(t.orgName)>0&&window.location.pathname.toLowerCase().indexOf("home")<0&&window.location.pathname.toLowerCase().indexOf(o)>=0?window.location.pathname:`${null==t.orgName?"":`/${t.orgName}`}${""==o?null==t.orgName?window.location.pathname:window.location.pathname.toLowerCase().replace(`${t.orgName.toLowerCase()}`,""):`/${o}`}`)+t.link,l="_self";1==t.type&&0!=t.status&&d.find("a").append(`<span class="status status${t.status}">${t.statusName}</span>`),/^http/.test(r)||(r=r.replace("//","/"));const p={href:r,title:`連結至: ${t.title}${"_blank"==l?"(另開視窗)":""}`,target:l};"A"==d[0].tagName?d.attr(p):d.find("a").attr(p);var g=t.mainImage||"/images/noImg.jpg";if(null!=t.orgName&&("undefined"!=typeof IsFaPage&&"undefined"!=typeof OrgName&&!IsFaPage||"undefined"!=typeof OrgName&&OrgName!=t.orgName)&&(g=g.replace("upload",`upload/${t.orgName}`)),d.find("img").attr("src",g),d.find("img").imgCheck().attr("alt",`${t.title}的主要圖片`),d.find(".title").text(t.title),d.find(".description").html(t.description),d.find(".location").length>0&&(null==t.location||""==t.location)?d.find(".location").parents(".py-2").remove():d.find(".location").text(t.location),d.find(".address").length>0&&(null==t.address||""==t.address)?d.find(".address").parents(".py-2").remove():d.find(".address").text(t.address),null!=t.startTime&&""!=t.startTime){var f=new Date(t.startTime);d.find(".startTime").text(`${f.getFullYear()}/${f.getMonth()+1}/${f.getDate()}`)}else d.find(".startTime").each(((e,t)=>{"span"==t.tagName.toLowerCase()?$(t).parent().remove():$(t).remove()}));if(null!=t.nodeDate&&""!=t.nodeDate){var m=new Date(t.nodeDate);d.find(".date").text(`${m.getFullYear()}/${m.getMonth()+1}/${m.getDate()}`),d.find(".date-month").text(`${m.getMonth()+1}月`),d.find(".date-monthyear").text(`${m.getMonth()+1}/${m.getFullYear()}`),m.getDate()<10?d.find(".date-day").text(`0${m.getDate()}`):d.find(".date-day").text(`${m.getDate()}`),m.getMonth()<9?d.find(".date-month-number").text(`0${m.getMonth()+1}`):d.find(".date-month-number").text(`${m.getMonth()+1}`),d.find(".date-year").text(`${m.getFullYear()}`)}else d.find(".date,.date-month,date-monthyear,date-day").each(((e,t)=>{"span"==t.tagName.toLowerCase()?$(t).parent().remove():$(t).remove()}));if(null!=t.price){const e=e=>e.includes("~")?([price_low,price_mid,price_high]=e.split(" "),price_high):e,a=t=>Intl.NumberFormat().format(e(t));if(d.find(".normal-price").text(a(t.price)),d.find(".price-grid").text(a(t.price)),null!=t.itemNo&&""!=t.itemNo?d.find(".itemNo").text(t.itemNo):d.find(".itemNo").remove(),$tags=d.find(".tags"),$tags.empty(),t.tags.slice(0,2).forEach((e=>{let t=$(n).clone();t.text(e.tag_Name.slice(0,4)),$tags.append(t)})),t.tags.slice(2).forEach((e=>{let t=$(n).clone();t.text(e.tag_Name.slice(0,4)),t.addClass("more-tag d-none"),$tags.append(t)})),t.tags.length>2){let e=$(n).clone();e.text("..."),e.addClass("less-tag"),$tags.append(e)}$tags.children().each((function(){$(this).on("click",(function(){return location.href=`/${OrgName}/Search/Get/3/${$(this).text()}`,!1}))}))}else d.find(".itemNo,.price").remove();d.find(".shareBlock > a").remove(),d.find(".shareBlock").data("href",r),e.find(".catalog").append(d)})),HoverEffectInit(),ShareBlockInit()}